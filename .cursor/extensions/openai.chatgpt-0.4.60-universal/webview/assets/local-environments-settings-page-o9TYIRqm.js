import{bN as Et,c as oe,j as o,B as ce,bb as Rt,M as S,bO as ct,bP as wt,r as ne,bQ as $t,bR as Wt,bS as Bt,bm as Ut,bT as jt,bU as Vt,h as qe,k as Gt,i as zt,bV as qt,e as Ht,n as dt,a as I,b as se,g as kt,bW as Kt,bX as Qt,bY as Xt,bZ as Yt,b_ as Zt,b$ as Jt,c0 as es,b6 as ts,c1 as Ft,c2 as Lt,m as At,d as ve,b8 as ss,c3 as is,c4 as ns,f as we,S as je,bi as rs}from"./index-BANRepXe.js";function Nt(t,e){const s=Et(t)??t;return e?.label??s}function os(t){const e=oe.c(17),{workspaceRoot:s,workspaceGroup:i,mode:n,onBack:r}=t;let a;e[0]!==i||e[1]!==s?(a=Nt(s,i),e[0]=i,e[1]=s,e[2]=a):a=e[2];const c=a;let u;e[3]!==r?(u=r?o.jsxs(ce,{color:"ghost",size:"toolbar",onClick:r,children:[o.jsx(Rt,{className:"icon-2xs"}),o.jsx(S,{id:"settings.localEnvironments.breadcrumb.back",defaultMessage:"Back",description:"Button label to go back to local environments list"})]}):null,e[3]=r,e[4]=u):u=e[4];let m,l;e[5]===Symbol.for("react.memo_cache_sentinel")?(m=o.jsx("span",{children:o.jsx(S,{id:"settings.localEnvironments.breadcrumb.root",defaultMessage:"Environments",description:"Breadcrumb label for the local environments page"})}),l=o.jsx(ct,{className:"icon-xs text-token-text-secondary"}),e[5]=m,e[6]=l):(m=e[5],l=e[6]);let d;e[7]!==c?(d=o.jsx("span",{className:"text-token-text-primary",children:c}),e[7]=c,e[8]=d):d=e[8];let h;e[9]!==n?(h=n==="edit"?o.jsxs(o.Fragment,{children:[o.jsx(ct,{className:"icon-xs text-token-text-secondary"}),o.jsx("span",{children:o.jsx(S,{id:"settings.localEnvironments.breadcrumb.edit",defaultMessage:"edit",description:"Breadcrumb label for local environment edit mode"})})]}):null,e[9]=n,e[10]=h):h=e[10];let f;e[11]!==d||e[12]!==h?(f=o.jsxs("div",{className:"flex items-center gap-1",children:[m,l,d,h]}),e[11]=d,e[12]=h,e[13]=f):f=e[13];let p;return e[14]!==u||e[15]!==f?(p=o.jsxs("nav",{className:"flex items-center gap-2 text-sm text-token-text-secondary",children:[u,f]}),e[14]=u,e[15]=f,e[16]=p):p=e[16],p}const Me=new WeakMap,$e=new WeakMap,Ue={current:[]};let Ke=!1,Le=0;const ke=new Set,Ie=new Map;function Tt(t){const e=Array.from(t).sort((s,i)=>s instanceof me&&s.options.deps.includes(i)?1:i instanceof me&&i.options.deps.includes(s)?-1:0);for(const s of e){if(Ue.current.includes(s))continue;Ue.current.push(s),s.recompute();const i=$e.get(s);if(i)for(const n of i){const r=Me.get(n);r&&Tt(r)}}}function as(t){const e={prevVal:t.prevState,currentVal:t.state};for(const s of t.listeners)s(e)}function ls(t){const e={prevVal:t.prevState,currentVal:t.state};for(const s of t.listeners)s(e)}function It(t){if(Le>0&&!Ie.has(t)&&Ie.set(t,t.prevState),ke.add(t),!(Le>0)&&!Ke)try{for(Ke=!0;ke.size>0;){const e=Array.from(ke);ke.clear();for(const s of e){const i=Ie.get(s)??s.prevState;s.prevState=i,as(s)}for(const s of e){const i=Me.get(s);i&&(Ue.current.push(s),Tt(i))}for(const s of e){const i=Me.get(s);if(i)for(const n of i)ls(n)}}}finally{Ke=!1,Ue.current=[],Ie.clear()}}function ue(t){Le++;try{t()}finally{if(Le--,Le===0){const e=ke.values().next().value;e&&It(e)}}}function cs(t){return typeof t=="function"}class tt{constructor(e,s){this.listeners=new Set,this.subscribe=i=>{var n,r;this.listeners.add(i);const a=(r=(n=this.options)==null?void 0:n.onSubscribe)==null?void 0:r.call(n,i,this);return()=>{this.listeners.delete(i),a?.()}},this.prevState=e,this.state=e,this.options=s}setState(e){var s,i,n;this.prevState=this.state,(s=this.options)!=null&&s.updateFn?this.state=this.options.updateFn(this.prevState)(e):cs(e)?this.state=e(this.prevState):this.state=e,(n=(i=this.options)==null?void 0:i.onUpdate)==null||n.call(i),It(this)}}class me{constructor(e){this.listeners=new Set,this._subscriptions=[],this.lastSeenDepValues=[],this.getDepVals=()=>{const s=this.options.deps.length,i=new Array(s),n=new Array(s);for(let r=0;r<s;r++){const a=this.options.deps[r];i[r]=a.prevState,n[r]=a.state}return this.lastSeenDepValues=n,{prevDepVals:i,currDepVals:n,prevVal:this.prevState??void 0}},this.recompute=()=>{var s,i;this.prevState=this.state;const n=this.getDepVals();this.state=this.options.fn(n),(i=(s=this.options).onUpdate)==null||i.call(s)},this.checkIfRecalculationNeededDeeply=()=>{for(const r of this.options.deps)r instanceof me&&r.checkIfRecalculationNeededDeeply();let s=!1;const i=this.lastSeenDepValues,{currDepVals:n}=this.getDepVals();for(let r=0;r<n.length;r++)if(n[r]!==i[r]){s=!0;break}s&&this.recompute()},this.mount=()=>(this.registerOnGraph(),this.checkIfRecalculationNeededDeeply(),()=>{this.unregisterFromGraph();for(const s of this._subscriptions)s()}),this.subscribe=s=>{var i,n;this.listeners.add(s);const r=(n=(i=this.options).onSubscribe)==null?void 0:n.call(i,s,this);return()=>{this.listeners.delete(s),r?.()}},this.options=e,this.state=e.fn({prevDepVals:void 0,prevVal:void 0,currDepVals:this.getDepVals().currDepVals})}registerOnGraph(e=this.options.deps){for(const s of e)if(s instanceof me)s.registerOnGraph(),this.registerOnGraph(s.options.deps);else if(s instanceof tt){let i=Me.get(s);i||(i=new Set,Me.set(s,i)),i.add(this);let n=$e.get(this);n||(n=new Set,$e.set(this,n)),n.add(s)}}unregisterFromGraph(e=this.options.deps){for(const s of e)if(s instanceof me)this.unregisterFromGraph(s.options.deps);else if(s instanceof tt){const i=Me.get(s);i&&i.delete(this);const n=$e.get(this);n&&n.delete(s)}}}var ds=class{constructor(t,e){this.fn=t,this.options=e,this.lastExecutionTime=0,this.isPending=!1,this.maybeExecute=(...s)=>{const i=Date.now()-this.lastExecutionTime;if(this.options.leading&&i>=this.options.wait)this.execute(...s);else if(this.lastArgs=s,!this.timeoutId&&this.options.trailing){const n=this.options.wait-i;this.isPending=!0,this.timeoutId=setTimeout(()=>{this.lastArgs!==void 0&&this.execute(...this.lastArgs)},n)}},this.execute=(...s)=>{this.fn(...s),this.options.onExecute?.(s,this),this.lastExecutionTime=Date.now(),this.clearTimeout(),this.lastArgs=void 0,this.isPending=!1},this.flush=()=>{this.isPending&&this.lastArgs&&this.execute(...this.lastArgs)},this.cancel=()=>{this.clearTimeout(),this.lastArgs=void 0,this.isPending=!1},this.clearTimeout=()=>{this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0)},this.options.leading===void 0&&this.options.trailing===void 0&&(this.options.leading=!0,this.options.trailing=!0)}};function us(t,e){return new ds(t,e).maybeExecute}class fs{#r=!0;#t;#e;#u;#s;#a;#i;#l;#f=0;#h=5;#o=!1;#c=!1;#n=null;#m=()=>{this.debugLog("Connected to event bus"),this.#a=!0,this.#o=!1,this.debugLog("Emitting queued events",this.#s),this.#s.forEach(e=>this.emitEventToBus(e)),this.#s=[],this.stopConnectLoop(),this.#e().removeEventListener("tanstack-connect-success",this.#m)};#d=()=>{if(this.#f<this.#h){this.#f++,this.dispatchCustomEvent("tanstack-connect",{});return}this.#e().removeEventListener("tanstack-connect",this.#d),this.#c=!0,this.debugLog("Max retries reached, giving up on connection"),this.stopConnectLoop()};#p=()=>{this.#o||(this.#o=!0,this.#e().addEventListener("tanstack-connect-success",this.#m),this.#d())};constructor({pluginId:e,debug:s=!1,enabled:i=!0,reconnectEveryMs:n=300}){this.#t=e,this.#r=i,this.#e=this.getGlobalTarget,this.#u=s,this.debugLog(" Initializing event subscription for plugin",this.#t),this.#s=[],this.#a=!1,this.#c=!1,this.#i=null,this.#l=n}startConnectLoop(){this.#i!==null||this.#a||(this.debugLog(`Starting connect loop (every ${this.#l}ms)`),this.#i=setInterval(this.#d,this.#l))}stopConnectLoop(){this.#o=!1,this.#i!==null&&(clearInterval(this.#i),this.#i=null,this.#s=[],this.debugLog("Stopped connect loop"))}debugLog(...e){this.#u&&console.log(`ðŸŒ´ [tanstack-devtools:${this.#t}-plugin]`,...e)}getGlobalTarget(){if(typeof globalThis<"u"&&globalThis.__TANSTACK_EVENT_TARGET__)return this.debugLog("Using global event target"),globalThis.__TANSTACK_EVENT_TARGET__;if(typeof window<"u"&&typeof window.addEventListener<"u")return this.debugLog("Using window as event target"),window;const e=typeof EventTarget<"u"?new EventTarget:void 0;return typeof e>"u"||typeof e.addEventListener>"u"?(this.debugLog("No event mechanism available, running in non-web environment"),{addEventListener:()=>{},removeEventListener:()=>{},dispatchEvent:()=>!1}):(this.debugLog("Using new EventTarget as fallback"),e)}getPluginId(){return this.#t}dispatchCustomEventShim(e,s){try{const i=new Event(e,{detail:s});this.#e().dispatchEvent(i)}catch{this.debugLog("Failed to dispatch shim event")}}dispatchCustomEvent(e,s){try{this.#e().dispatchEvent(new CustomEvent(e,{detail:s}))}catch{this.dispatchCustomEventShim(e,s)}}emitEventToBus(e){this.debugLog("Emitting event to client bus",e),this.dispatchCustomEvent("tanstack-dispatch-event",e)}createEventPayload(e,s){return{type:`${this.#t}:${e}`,payload:s,pluginId:this.#t}}emit(e,s){if(!this.#r){this.debugLog("Event bus client is disabled, not emitting event",e,s);return}if(this.#n&&(this.debugLog("Emitting event to internal event target",e,s),this.#n.dispatchEvent(new CustomEvent(`${this.#t}:${e}`,{detail:this.createEventPayload(e,s)}))),this.#c){this.debugLog("Previously failed to connect, not emitting to bus");return}if(!this.#a){this.debugLog("Bus not available, will be pushed as soon as connected"),this.#s.push(this.createEventPayload(e,s)),typeof CustomEvent<"u"&&!this.#o&&(this.#p(),this.startConnectLoop());return}return this.emitEventToBus(this.createEventPayload(e,s))}on(e,s,i){const n=i?.withEventTarget??!1,r=`${this.#t}:${e}`;if(n&&(this.#n||(this.#n=new EventTarget),this.#n.addEventListener(r,c=>{s(c.detail)})),!this.#r)return this.debugLog("Event bus client is disabled, not registering event",r),()=>{};const a=c=>{this.debugLog("Received event from bus",c.detail),s(c.detail)};return this.#e().addEventListener(r,a),this.debugLog("Registered event to bus",r),()=>{n&&this.#n?.removeEventListener(r,a),this.#e().removeEventListener(r,a)}}onAll(e){if(!this.#r)return this.debugLog("Event bus client is disabled, not registering event"),()=>{};const s=i=>{const n=i.detail;e(n)};return this.#e().addEventListener("tanstack-devtools-global",s),()=>this.#e().removeEventListener("tanstack-devtools-global",s)}onAllPluginEvents(e){if(!this.#r)return this.debugLog("Event bus client is disabled, not registering event"),()=>{};const s=i=>{const n=i.detail;this.#t&&n.pluginId!==this.#t||e(n)};return this.#e().addEventListener("tanstack-devtools-global",s),()=>this.#e().removeEventListener("tanstack-devtools-global",s)}}class ms extends fs{constructor(){super({pluginId:"form-devtools",reconnectEveryMs:1e3})}}const le=new ms;function He(t,e){return typeof t=="function"?t(e):t}function _e(t,e){return lt(e).reduce((i,n)=>{if(i===null)return null;if(typeof i<"u")return i[n]},t)}function Ce(t,e,s){const i=lt(e);function n(r){if(!i.length)return He(s,r);const a=i.shift();if(typeof a=="string"||typeof a=="number"&&!Array.isArray(r))return typeof r=="object"?(r===null&&(r={}),{...r,[a]:n(r[a])}):{[a]:n()};if(Array.isArray(r)&&typeof a=="number"){const c=r.slice(0,a);return[...c.length?c:new Array(a),n(r[a]),...r.slice(a+1)]}return[...new Array(a),n()]}return n(t)}function hs(t,e){const s=lt(e);function i(n){if(!n)return;if(s.length===1){const a=s[0];if(Array.isArray(n)&&typeof a=="number")return n.filter((m,l)=>l!==a);const{[a]:c,...u}=n;return u}const r=s.shift();if((typeof r=="string"||typeof r=="number"&&!Array.isArray(n))&&typeof n=="object")return{...n,[r]:i(n[r])};if(typeof r=="number"&&Array.isArray(n)){if(r>=n.length)return n;const a=n.slice(0,r);return[...a.length?a:new Array(r),i(n[r]),...n.slice(r+1)]}throw new Error("It seems we have created an infinite loop in deleteBy. ")}return i(t)}const ps=/^(\d+)$/gm,vs=/\.(\d+)(?=\.)/gm,gs=/^(\d+)\./gm,xs=/\.(\d+$)/gm,bs=/\.{2,}/gm,st="__int__",De=`${st}$1`;function lt(t){if(Array.isArray(t))return[...t];if(typeof t!="string")throw new Error("Path must be a string.");return t.replace(/(^\[)|]/gm,"").replace(/\[/g,".").replace(ps,De).replace(vs,`.${De}.`).replace(gs,`${De}.`).replace(xs,`.${De}`).replace(bs,".").split(".").map(e=>{if(e.startsWith(st)){const s=e.substring(st.length),i=parseInt(s,10);return String(i)===s?i:s}return e})}function ys(t){return!(Array.isArray(t)&&t.length===0)}function it(t,e){const s=i=>i.validators.filter(Boolean).map(n=>({cause:n.cause,validate:n.fn}));return e.validationLogic({form:e.form,validators:e.validators,event:{type:t,async:!1},runValidation:s})}function nt(t,e){const{asyncDebounceMs:s}=e,{onBlurAsyncDebounceMs:i,onChangeAsyncDebounceMs:n,onDynamicAsyncDebounceMs:r}=e.validators||{},a=s??0,c=u=>u.validators.filter(Boolean).map(m=>{const l=m?.cause||t;let d=a;switch(l){case"change":d=n??a;break;case"blur":d=i??a;break;case"dynamic":d=r??a;break;case"submit":d=0;break}return t==="submit"&&(d=0),{cause:l,validate:m.fn,debounceMs:d}});return e.validationLogic({form:e.form,validators:e.validators,event:{type:t,async:!0},runValidation:c})}const rt=t=>!!t&&typeof t=="object"&&"fields"in t;function pe(t,e){if(Object.is(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;if(t instanceof Date&&e instanceof Date)return t.getTime()===e.getTime();if(t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(const[n,r]of t)if(!e.has(n)||!Object.is(r,e.get(n)))return!1;return!0}if(t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;return!0}const s=Object.keys(t),i=Object.keys(e);if(s.length!==i.length)return!1;for(const n of s)if(!i.includes(n)||!pe(t[n],e[n]))return!1;return!0}const ut=({newFormValidatorError:t,isPreviousErrorFromFormValidator:e,previousErrorValue:s})=>t?{newErrorValue:t,newSource:"form"}:e?{newErrorValue:void 0,newSource:void 0}:s?{newErrorValue:s,newSource:"field"}:{newErrorValue:void 0,newSource:void 0},ft=({formLevelError:t,fieldLevelError:e})=>e?{newErrorValue:e,newSource:"field"}:t?{newErrorValue:t,newSource:"form"}:{newErrorValue:void 0,newSource:void 0};function ie(t,e){return t==null?e:{...t,...e}}let ge=256;const We=[];let Pe;for(;ge--;)We[ge]=(ge+256).toString(16).substring(1);function _t(){let t=0,e,s="";if(!Pe||ge+16>256){for(Pe=new Array(256),t=256;t--;)Pe[t]=256*Math.random()|0;t=0,ge=0}for(;t<16;t++)e=Pe[ge+t],t===6?s+=We[e&15|64]:t===8?s+=We[e&63|128]:s+=We[e],t&1&&t>1&&t<11&&(s+="-");return ge++,s}const Ss=us(t=>le.emit("form-state",{id:t.formId,state:t.store.state}),{wait:300}),ye=t=>{if(!t.validators)return t.runValidation({validators:[],form:t.form});const e=t.event.async,s=e?void 0:{fn:t.validators.onMount,cause:"mount"},i={fn:e?t.validators.onChangeAsync:t.validators.onChange,cause:"change"},n={fn:e?t.validators.onBlurAsync:t.validators.onBlur,cause:"blur"},r={fn:e?t.validators.onSubmitAsync:t.validators.onSubmit,cause:"submit"},a=e?void 0:{fn:()=>{},cause:"server"};switch(t.event.type){case"mount":return t.runValidation({validators:[s],form:t.form});case"submit":return t.runValidation({validators:[i,n,r,a],form:t.form});case"server":return t.runValidation({validators:[],form:t.form});case"blur":return t.runValidation({validators:[n,a],form:t.form});case"change":return t.runValidation({validators:[i,a],form:t.form});default:throw new Error(`Unknown validation event type: ${t.event.type}`)}};function Ms(t,e){const s=new Map;for(const i of t){const n=i.path??[];let r=e,a="";for(let c=0;c<n.length;c++){const u=n[c];if(u===void 0)continue;const m=typeof u=="object"?u.key:u,l=Number(m);Array.isArray(r)&&!Number.isNaN(l)?a+=`[${l}]`:a+=(c>0?".":"")+String(m),typeof r=="object"&&r!==null?r=r[m]:r=void 0}s.set(a,(s.get(a)??[]).concat(i))}return Object.fromEntries(s)}const mt=(t,e)=>{const s=Ms(t,e);return{form:s,fields:s}},Ee={validate({value:t,validationSource:e},s){const i=s["~standard"].validate(t);if(i instanceof Promise)throw new Error("async function passed to sync validator");if(i.issues)return e==="field"?i.issues:mt(i.issues,t)},async validateAsync({value:t,validationSource:e},s){const i=await s["~standard"].validate(t);if(i.issues)return e==="field"?i.issues:mt(i.issues,t)}},Ct=t=>!!t&&"~standard"in t,Se={isValidating:!1,isTouched:!1,isBlurred:!1,isDirty:!1,isPristine:!0,isValid:!0,isDefaultValue:!0,errors:[],errorMap:{},errorSourceMap:{}};function Oe(t){function e(l,d,h){const f=a(l,d,"move",h),p=Math.min(d,h),v=Math.max(d,h);for(let g=p;g<=v;g++)f.push(r(l,g));const b=Object.keys(t.fieldInfo).reduce((g,x)=>(x.startsWith(r(l,d))&&g.set(x,t.getFieldMeta(x)),g),new Map);u(f,d<h?"up":"down"),Object.keys(t.fieldInfo).filter(g=>g.startsWith(r(l,h))).forEach(g=>{const x=g.replace(r(l,h),r(l,d)),M=b.get(x);M&&t.setFieldMeta(g,M)})}function s(l,d){const h=a(l,d,"remove");u(h,"up")}function i(l,d,h){a(l,d,"swap",h).forEach(p=>{if(!p.toString().startsWith(r(l,d)))return;const v=p.toString().replace(r(l,d),r(l,h)),[b,g]=[t.getFieldMeta(p),t.getFieldMeta(v)];b&&t.setFieldMeta(v,b),g&&t.setFieldMeta(p,g)})}function n(l,d){const h=a(l,d,"insert");u(h,"down"),h.forEach(f=>{f.toString().startsWith(r(l,d))&&t.setFieldMeta(f,m())})}function r(l,d){return`${l}[${d}]`}function a(l,d,h,f){const p=[r(l,d)];switch(h){case"swap":p.push(r(l,f));break;case"move":{const[v,b]=[Math.min(d,f),Math.max(d,f)];for(let g=v;g<=b;g++)p.push(r(l,g));break}default:{const v=t.getFieldValue(l),b=Array.isArray(v)?v.length:0;for(let g=d+1;g<b;g++)p.push(r(l,g));break}}return Object.keys(t.fieldInfo).filter(v=>p.some(b=>v.startsWith(b)))}function c(l,d){return l.replace(/\[(\d+)\]/,(h,f)=>{const p=parseInt(f,10);return`[${d==="up"?p+1:Math.max(0,p-1)}]`})}function u(l,d){(d==="up"?l:[...l].reverse()).forEach(f=>{const p=c(f.toString(),d),v=t.getFieldMeta(p);v?t.setFieldMeta(f,v):t.setFieldMeta(f,m())})}const m=()=>Se;return{handleArrayMove:e,handleArrayRemove:s,handleArraySwap:i,handleArrayInsert:n}}function Qe(t){return{values:t.values??{},errorMap:t.errorMap??{},fieldMetaBase:t.fieldMetaBase??{},isSubmitted:t.isSubmitted??!1,isSubmitting:t.isSubmitting??!1,isValidating:t.isValidating??!1,submissionAttempts:t.submissionAttempts??0,isSubmitSuccessful:t.isSubmitSuccessful??!1,validationMetaMap:t.validationMetaMap??{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0,onDynamic:void 0}}}class ht{constructor(e){this.options={},this.fieldInfo={},this.prevTransformArray=[],this.mount=()=>{const s=this.fieldMetaDerived.mount(),i=this.store.mount(),n=this.store.subscribe(()=>{Ss(this)}),r=le.on("request-form-state",l=>{l.payload.id===this._formId&&le.emit("form-api",{id:this._formId,state:this.store.state,options:this.options})}),a=le.on("request-form-reset",l=>{l.payload.id===this._formId&&this.reset()}),c=le.on("request-form-force-submit",l=>{l.payload.id===this._formId&&(this._devtoolsSubmissionOverride=!0,this.handleSubmit(),this._devtoolsSubmissionOverride=!1)}),u=()=>{c(),a(),r(),n(),s(),i(),le.emit("form-unmounted",{id:this._formId})};this.options.listeners?.onMount?.({formApi:this});const{onMount:m}=this.options.validators||{};return le.emit("form-api",{id:this._formId,state:this.store.state,options:this.options}),m&&this.validateSync("mount"),u},this.update=s=>{if(!s)return;const i=this.options;this.options=s;const n=!!s.transform?.deps?.some((c,u)=>c!==this.prevTransformArray[u]),r=s.defaultValues&&!pe(s.defaultValues,i.defaultValues)&&!this.state.isTouched,a=!pe(s.defaultState,i.defaultState)&&!this.state.isTouched;!r&&!a&&!n||(ue(()=>{this.baseStore.setState(()=>Qe(Object.assign({},this.state,a?s.defaultState:{},r?{values:s.defaultValues}:{},n?{_force_re_eval:!this.state._force_re_eval}:{})))}),le.emit("form-api",{id:this._formId,state:this.store.state,options:this.options}))},this.reset=(s,i)=>{const{fieldMeta:n}=this.state,r=this.resetFieldMeta(n);s&&!i?.keepDefaultValues&&(this.options={...this.options,defaultValues:s}),this.baseStore.setState(()=>Qe({...this.options.defaultState,values:s??this.options.defaultValues??this.options.defaultState?.values,fieldMetaBase:r}))},this.validateAllFields=async s=>{const i=[];return ue(()=>{Object.values(this.fieldInfo).forEach(r=>{if(!r.instance)return;const a=r.instance;i.push(Promise.resolve().then(()=>a.validate(s,{skipFormValidation:!0}))),r.instance.state.meta.isTouched||r.instance.setMeta(c=>({...c,isTouched:!0}))})}),(await Promise.all(i)).flat()},this.validateArrayFieldsStartingFrom=async(s,i,n)=>{const r=this.getFieldValue(s),a=Array.isArray(r)?Math.max(r.length-1,0):null,c=[`${s}[${i}]`];for(let d=i+1;d<=(a??0);d++)c.push(`${s}[${d}]`);const u=Object.keys(this.fieldInfo).filter(d=>c.some(h=>d.startsWith(h))),m=[];return ue(()=>{u.forEach(d=>{m.push(Promise.resolve().then(()=>this.validateField(d,n)))})}),(await Promise.all(m)).flat()},this.validateField=(s,i)=>{const n=this.fieldInfo[s]?.instance;return n?(n.state.meta.isTouched||n.setMeta(r=>({...r,isTouched:!0})),n.validate(i)):[]},this.validateSync=s=>{const i=it(s,{...this.options,form:this,validationLogic:this.options.validationLogic||ye});let n=!1;const r={};return ue(()=>{for(const u of i){if(!u.validate)continue;const m=this.runValidator({validate:u.validate,value:{value:this.state.values,formApi:this,validationSource:"form"},type:"validate"}),{formError:l,fieldErrors:d}=Be(m),h=Ve(u.cause),f=new Set([...Object.keys(this.state.fieldMeta),...Object.keys(d||{})]);for(const p of f){if(this.baseStore.state.fieldMetaBase[p]===void 0&&!d?.[p])continue;const v=this.getFieldMeta(p)??Se,{errorMap:b,errorSourceMap:g}=v,x=d?.[p],{newErrorValue:M,newSource:y}=ut({newFormValidatorError:x,isPreviousErrorFromFormValidator:g?.[h]==="form",previousErrorValue:b?.[h]});y==="form"&&(r[p]={...r[p],[h]:x}),b?.[h]!==M&&this.setFieldMeta(p,(L=Se)=>({...L,errorMap:{...L.errorMap,[h]:M},errorSourceMap:{...L.errorSourceMap,[h]:y}}))}this.state.errorMap?.[h]!==l&&this.baseStore.setState(p=>({...p,errorMap:{...p.errorMap,[h]:l}})),(l||d)&&(n=!0)}const a=Ve("submit");this.state.errorMap?.[a]&&s!=="submit"&&!n&&this.baseStore.setState(u=>({...u,errorMap:{...u.errorMap,[a]:void 0}}));const c=Ve("server");this.state.errorMap?.[c]&&s!=="server"&&!n&&this.baseStore.setState(u=>({...u,errorMap:{...u.errorMap,[c]:void 0}}))}),{hasErrored:n,fieldsErrorMap:r}},this.validateAsync=async s=>{const i=nt(s,{...this.options,form:this,validationLogic:this.options.validationLogic||ye});this.state.isFormValidating||this.baseStore.setState(u=>({...u,isFormValidating:!0}));const n=[];let r;for(const u of i){if(!u.validate)continue;const m=Ve(u.cause);this.state.validationMetaMap[m]?.lastAbortController.abort();const d=new AbortController;this.state.validationMetaMap[m]={lastAbortController:d},n.push(new Promise(async h=>{let f;try{f=await new Promise((g,x)=>{setTimeout(async()=>{if(d.signal.aborted)return g(void 0);try{g(await this.runValidator({validate:u.validate,value:{value:this.state.values,formApi:this,validationSource:"form",signal:d.signal},type:"validateAsync"}))}catch(M){x(M)}},u.debounceMs)})}catch(g){f=g}const{formError:p,fieldErrors:v}=Be(f);v&&(r=r?{...r,...v}:v);const b=Ve(u.cause);for(const g of Object.keys(this.state.fieldMeta)){if(this.baseStore.state.fieldMetaBase[g]===void 0)continue;const x=this.getFieldMeta(g);if(!x)continue;const{errorMap:M,errorSourceMap:y}=x,L=r?.[g],{newErrorValue:E,newSource:j}=ut({newFormValidatorError:L,isPreviousErrorFromFormValidator:y?.[b]==="form",previousErrorValue:M?.[b]});M?.[b]!==E&&this.setFieldMeta(g,A=>({...A,errorMap:{...A.errorMap,[b]:E},errorSourceMap:{...A.errorSourceMap,[b]:j}}))}this.baseStore.setState(g=>({...g,errorMap:{...g.errorMap,[b]:p}})),h(r?{fieldErrors:r,errorMapKey:b}:void 0)}))}let a=[];const c={};if(n.length){a=await Promise.all(n);for(const u of a)if(u?.fieldErrors){const{errorMapKey:m}=u;for(const[l,d]of Object.entries(u.fieldErrors)){const f={...c[l]||{},[m]:d};c[l]=f}}}return this.baseStore.setState(u=>({...u,isFormValidating:!1})),c},this.validate=s=>{const{hasErrored:i,fieldsErrorMap:n}=this.validateSync(s);return i&&!this.options.asyncAlways?n:this.validateAsync(s)},this._handleSubmit=async s=>{this.baseStore.setState(r=>({...r,isSubmitted:!1,submissionAttempts:r.submissionAttempts+1,isSubmitSuccessful:!1})),ue(()=>{Object.values(this.fieldInfo).forEach(r=>{r.instance&&(r.instance.state.meta.isTouched||r.instance.setMeta(a=>({...a,isTouched:!0})))})});const i=s??this.options.onSubmitMeta;if(!this.state.canSubmit&&!this._devtoolsSubmissionOverride){this.options.onSubmitInvalid?.({value:this.state.values,formApi:this,meta:i});return}this.baseStore.setState(r=>({...r,isSubmitting:!0}));const n=()=>{this.baseStore.setState(r=>({...r,isSubmitting:!1}))};if(await this.validateAllFields("submit"),!this.state.isFieldsValid){n(),this.options.onSubmitInvalid?.({value:this.state.values,formApi:this,meta:i}),le.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"validateAllFields",errors:Object.values(this.state.fieldMeta).map(r=>r.errors).flat()});return}if(await this.validate("submit"),!this.state.isValid){n(),this.options.onSubmitInvalid?.({value:this.state.values,formApi:this,meta:i}),le.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"validate",errors:this.state.errors});return}ue(()=>{Object.values(this.fieldInfo).forEach(r=>{r.instance?.options.listeners?.onSubmit?.({value:r.instance.state.value,fieldApi:r.instance})})}),this.options.listeners?.onSubmit?.({formApi:this,meta:i});try{await this.options.onSubmit?.({value:this.state.values,formApi:this,meta:i}),ue(()=>{this.baseStore.setState(r=>({...r,isSubmitted:!0,isSubmitSuccessful:!0})),le.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!0}),n()})}catch(r){throw this.baseStore.setState(a=>({...a,isSubmitSuccessful:!1})),le.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"inflight",onError:r}),n(),r}},this.getFieldValue=s=>_e(this.state.values,s),this.getFieldMeta=s=>this.state.fieldMeta[s],this.getFieldInfo=s=>this.fieldInfo[s]||={instance:null,validationMetaMap:{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0,onDynamic:void 0}},this.setFieldMeta=(s,i)=>{this.baseStore.setState(n=>({...n,fieldMetaBase:{...n.fieldMetaBase,[s]:He(i,n.fieldMetaBase[s])}}))},this.resetFieldMeta=s=>Object.keys(s).reduce((i,n)=>{const r=n;return i[r]=Se,i},{}),this.setFieldValue=(s,i,n)=>{const r=n?.dontUpdateMeta??!1,a=n?.dontRunListeners??!1,c=n?.dontValidate??!1;ue(()=>{r||this.setFieldMeta(s,u=>({...u,isTouched:!0,isDirty:!0,errorMap:{...u?.errorMap,onMount:void 0}})),this.baseStore.setState(u=>({...u,values:Ce(u.values,s,i)}))}),a||this.getFieldInfo(s).instance?.triggerOnChangeListener(),c||this.validateField(s,"change")},this.deleteField=s=>{const n=[...Object.keys(this.fieldInfo).filter(r=>{const a=s.toString();return r!==a&&r.startsWith(a)}),s];this.baseStore.setState(r=>{const a={...r};return n.forEach(c=>{a.values=hs(a.values,c),delete this.fieldInfo[c],delete a.fieldMetaBase[c]}),a})},this.pushFieldValue=(s,i,n)=>{this.setFieldValue(s,r=>[...Array.isArray(r)?r:[],i],n)},this.insertFieldValue=async(s,i,n,r)=>{this.setFieldValue(s,c=>[...c.slice(0,i),n,...c.slice(i)],ie(r,{dontValidate:!0}));const a=r?.dontValidate??!1;a||await this.validateField(s,"change"),Oe(this).handleArrayInsert(s,i),a||await this.validateArrayFieldsStartingFrom(s,i,"change")},this.replaceFieldValue=async(s,i,n,r)=>{this.setFieldValue(s,c=>c.map((u,m)=>m===i?n:u),ie(r,{dontValidate:!0})),(r?.dontValidate??!1)||(await this.validateField(s,"change"),await this.validateArrayFieldsStartingFrom(s,i,"change"))},this.removeFieldValue=async(s,i,n)=>{const r=this.getFieldValue(s),a=Array.isArray(r)?Math.max(r.length-1,0):null;if(this.setFieldValue(s,u=>u.filter((m,l)=>l!==i),ie(n,{dontValidate:!0})),Oe(this).handleArrayRemove(s,i),a!==null){const u=`${s}[${a}]`;this.deleteField(u)}(n?.dontValidate??!1)||(await this.validateField(s,"change"),await this.validateArrayFieldsStartingFrom(s,i,"change"))},this.swapFieldValues=(s,i,n,r)=>{this.setFieldValue(s,c=>{const u=c[i],m=c[n];return Ce(Ce(c,`${i}`,m),`${n}`,u)},ie(r,{dontValidate:!0})),Oe(this).handleArraySwap(s,i,n),(r?.dontValidate??!1)||(this.validateField(s,"change"),this.validateField(`${s}[${i}]`,"change"),this.validateField(`${s}[${n}]`,"change"))},this.moveFieldValues=(s,i,n,r)=>{this.setFieldValue(s,c=>{const u=[...c];return u.splice(n,0,u.splice(i,1)[0]),u},ie(r,{dontValidate:!0})),Oe(this).handleArrayMove(s,i,n),(r?.dontValidate??!1)||(this.validateField(s,"change"),this.validateField(`${s}[${i}]`,"change"),this.validateField(`${s}[${n}]`,"change"))},this.clearFieldValues=(s,i)=>{const n=this.getFieldValue(s),r=Array.isArray(n)?Math.max(n.length-1,0):null;if(this.setFieldValue(s,[],ie(i,{dontValidate:!0})),r!==null)for(let c=0;c<=r;c++){const u=`${s}[${c}]`;this.deleteField(u)}(i?.dontValidate??!1)||this.validateField(s,"change")},this.resetField=s=>{this.baseStore.setState(i=>({...i,fieldMetaBase:{...i.fieldMetaBase,[s]:Se},values:this.options.defaultValues?Ce(i.values,s,_e(this.options.defaultValues,s)):i.values}))},this.setErrorMap=s=>{ue(()=>{Object.entries(s).forEach(([i,n])=>{const r=i;if(rt(n)){const{formError:a,fieldErrors:c}=Be(n);for(const u of Object.keys(this.fieldInfo))this.getFieldMeta(u)&&this.setFieldMeta(u,l=>({...l,errorMap:{...l.errorMap,[r]:c?.[u]},errorSourceMap:{...l.errorSourceMap,[r]:"form"}}));this.baseStore.setState(u=>({...u,errorMap:{...u.errorMap,[r]:a}}))}else this.baseStore.setState(a=>({...a,errorMap:{...a.errorMap,[r]:n}}))})})},this.getAllErrors=()=>({form:{errors:this.state.errors,errorMap:this.state.errorMap},fields:Object.entries(this.state.fieldMeta).reduce((s,[i,n])=>(Object.keys(n).length&&n.errors.length&&(s[i]={errors:n.errors,errorMap:n.errorMap}),s),{})}),this.parseValuesWithSchema=s=>Ee.validate({value:this.state.values,validationSource:"form"},s),this.parseValuesWithSchemaAsync=s=>Ee.validateAsync({value:this.state.values,validationSource:"form"},s),this.timeoutIds={validations:{},listeners:{},formListeners:{}},this._formId=e?.formId??_t(),this._devtoolsSubmissionOverride=!1,this.baseStore=new tt(Qe({...e?.defaultState,values:e?.defaultValues??e?.defaultState?.values})),this.fieldMetaDerived=new me({deps:[this.baseStore],fn:({prevDepVals:s,currDepVals:i,prevVal:n})=>{const r=n,a=s?.[0],c=i[0];let u=0;const m={};for(const l of Object.keys(c.fieldMetaBase)){const d=c.fieldMetaBase[l],h=a?.fieldMetaBase[l],f=r?.[l],p=_e(c.values,l);let v=f?.errors;if(!h||d.errorMap!==h.errorMap){v=Object.values(d.errorMap??{}).filter(y=>y!==void 0);const M=this.getFieldInfo(l)?.instance;M&&!M.options.disableErrorFlat&&(v=v.flat(1))}const b=!ys(v),g=!d.isDirty,x=pe(p,_e(this.options.defaultValues,l))||pe(p,this.getFieldInfo(l)?.instance?.options.defaultValue);if(f&&f.isPristine===g&&f.isValid===b&&f.isDefaultValue===x&&f.errors===v&&d===h){m[l]=f,u++;continue}m[l]={...d,errors:v??[],isPristine:g,isValid:b,isDefaultValue:x}}return Object.keys(c.fieldMetaBase).length&&r&&u===Object.keys(c.fieldMetaBase).length?r:m}}),this.store=new me({deps:[this.baseStore,this.fieldMetaDerived],fn:({prevDepVals:s,currDepVals:i,prevVal:n})=>{const r=n,a=s?.[0],c=i[0],u=i[1],m=Object.values(u).filter(Boolean),l=m.some(k=>k.isValidating),d=m.every(k=>k.isValid),h=m.some(k=>k.isTouched),f=m.some(k=>k.isBlurred),p=m.every(k=>k.isDefaultValue),v=h&&c.errorMap?.onMount,b=m.some(k=>k.isDirty),g=!b,x=!!(c.errorMap?.onMount||m.some(k=>k?.errorMap?.onMount)),M=!!l;let y=r?.errors??[];(!a||c.errorMap!==a.errorMap)&&(y=Object.values(c.errorMap).reduce((k,T)=>T===void 0?k:T&&rt(T)?(k.push(T.form),k):(k.push(T),k),[]));const L=y.length===0,E=d&&L,j=this.options.canSubmitWhenInvalid??!1,A=c.submissionAttempts===0&&!h&&!x||!M&&!c.isSubmitting&&E||j;let F=c.errorMap;if(v&&(y=y.filter(k=>k!==c.errorMap.onMount),F=Object.assign(F,{onMount:void 0})),r&&a&&r.errorMap===F&&r.fieldMeta===this.fieldMetaDerived.state&&r.errors===y&&r.isFieldsValidating===l&&r.isFieldsValid===d&&r.isFormValid===L&&r.isValid===E&&r.canSubmit===A&&r.isTouched===h&&r.isBlurred===f&&r.isPristine===g&&r.isDefaultValue===p&&r.isDirty===b&&pe(a,c))return r;let w={...c,errorMap:F,fieldMeta:this.fieldMetaDerived.state,errors:y,isFieldsValidating:l,isFieldsValid:d,isFormValid:L,isValid:E,canSubmit:A,isTouched:h,isBlurred:f,isPristine:g,isDefaultValue:p,isDirty:b};const _=this.options.transform?.deps??[];if(_.length!==this.prevTransformArray.length||_.some((k,T)=>k!==this.prevTransformArray[T])){const k=Object.assign({},this,{state:w});this.options.transform?.fn(k),w=k.state,this.prevTransformArray=_}return w}}),this.handleSubmit=this.handleSubmit.bind(this),this.update(e||{})}get state(){return this.store.state}get formId(){return this._formId}runValidator(e){return Ct(e.validate)?Ee[e.type](e.value,e.validate):e.validate(e.value)}handleSubmit(e){return this._handleSubmit(e)}}function Be(t){if(t){if(rt(t)){const e=Be(t.form).formError,s=t.fields;return{formError:e,fieldErrors:s}}return{formError:t}}return{formError:void 0}}function Ve(t){switch(t){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"dynamic":return"onDynamic";case"change":default:return"onChange"}}class pt{constructor(e){this.options={},this.mount=()=>{const s=this.store.mount();this.options.defaultValue!==void 0&&!this.getMeta().isTouched&&this.form.setFieldValue(this.name,this.options.defaultValue,{dontUpdateMeta:!0});const i=this.getInfo();i.instance=this,this.update(this.options);const{onMount:n}=this.options.validators||{};if(n){const r=this.runValidator({validate:n,value:{value:this.state.value,fieldApi:this,validationSource:"field"},type:"validate"});r&&this.setMeta(a=>({...a,errorMap:{...a?.errorMap,onMount:r},errorSourceMap:{...a?.errorSourceMap,onMount:"field"}}))}return this.options.listeners?.onMount?.({value:this.state.value,fieldApi:this}),s},this.update=s=>{if(this.options=s,this.name=s.name,!this.state.meta.isTouched&&this.options.defaultValue!==void 0){const i=this.form.getFieldValue(this.name);pe(i,s.defaultValue)||this.form.setFieldValue(this.name,s.defaultValue,{dontUpdateMeta:!0,dontValidate:!0,dontRunListeners:!0})}this.form.getFieldMeta(this.name)||this.form.setFieldMeta(this.name,this.state.meta)},this.getValue=()=>this.form.getFieldValue(this.name),this.setValue=(s,i)=>{this.form.setFieldValue(this.name,s,ie(i,{dontRunListeners:!0,dontValidate:!0})),i?.dontRunListeners||this.triggerOnChangeListener(),i?.dontValidate||this.validate("change")},this.getMeta=()=>this.store.state.meta,this.setMeta=s=>this.form.setFieldMeta(this.name,s),this.getInfo=()=>this.form.getFieldInfo(this.name),this.pushValue=(s,i)=>{this.form.pushFieldValue(this.name,s,ie(i,{dontRunListeners:!0})),i?.dontRunListeners||this.triggerOnChangeListener()},this.insertValue=(s,i,n)=>{this.form.insertFieldValue(this.name,s,i,ie(n,{dontRunListeners:!0})),n?.dontRunListeners||this.triggerOnChangeListener()},this.replaceValue=(s,i,n)=>{this.form.replaceFieldValue(this.name,s,i,ie(n,{dontRunListeners:!0})),n?.dontRunListeners||this.triggerOnChangeListener()},this.removeValue=(s,i)=>{this.form.removeFieldValue(this.name,s,ie(i,{dontRunListeners:!0})),i?.dontRunListeners||this.triggerOnChangeListener()},this.swapValues=(s,i,n)=>{this.form.swapFieldValues(this.name,s,i,ie(n,{dontRunListeners:!0})),n?.dontRunListeners||this.triggerOnChangeListener()},this.moveValue=(s,i,n)=>{this.form.moveFieldValues(this.name,s,i,ie(n,{dontRunListeners:!0})),n?.dontRunListeners||this.triggerOnChangeListener()},this.clearValues=s=>{this.form.clearFieldValues(this.name,ie(s,{dontRunListeners:!0})),s?.dontRunListeners||this.triggerOnChangeListener()},this.getLinkedFields=s=>{const i=Object.values(this.form.fieldInfo),n=[];for(const r of i){if(!r.instance)continue;const{onChangeListenTo:a,onBlurListenTo:c}=r.instance.options.validators||{};s==="change"&&a?.includes(this.name)&&n.push(r.instance),s==="blur"&&c?.includes(this.name)&&n.push(r.instance)}return n},this.validateSync=(s,i)=>{const n=it(s,{...this.options,form:this.form,validationLogic:this.form.options.validationLogic||ye}),a=this.getLinkedFields(s).reduce((m,l)=>{const d=it(s,{...l.options,form:l.form,validationLogic:l.form.options.validationLogic||ye});return d.forEach(h=>{h.field=l}),m.concat(d)},[]);let c=!1;ue(()=>{const m=(l,d)=>{const h=Re(d.cause),f=d.validate?vt(l.runValidator({validate:d.validate,value:{value:l.store.state.value,validationSource:"field",fieldApi:l},type:"validate"})):void 0,p=i[h],{newErrorValue:v,newSource:b}=ft({formLevelError:p,fieldLevelError:f});l.state.meta.errorMap?.[h]!==v&&l.setMeta(g=>({...g,errorMap:{...g.errorMap,[h]:v},errorSourceMap:{...g.errorSourceMap,[h]:b}})),v&&(c=!0)};for(const l of n)m(this,l);for(const l of a)l.validate&&m(l.field,l)});const u=Re("submit");return this.state.meta.errorMap?.[u]&&s!=="submit"&&!c&&this.setMeta(m=>({...m,errorMap:{...m.errorMap,[u]:void 0},errorSourceMap:{...m.errorSourceMap,[u]:void 0}})),{hasErrored:c}},this.validateAsync=async(s,i)=>{const n=nt(s,{...this.options,form:this.form,validationLogic:this.form.options.validationLogic||ye}),r=await i,a=this.getLinkedFields(s),c=a.reduce((f,p)=>{const v=nt(s,{...p.options,form:p.form,validationLogic:p.form.options.validationLogic||ye});return v.forEach(b=>{b.field=p}),f.concat(v)},[]),u=[],m=[],l=n.some(f=>f.validate)||c.some(f=>f.validate);if(l){this.state.meta.isValidating||this.setMeta(f=>({...f,isValidating:!0}));for(const f of a)f.setMeta(p=>({...p,isValidating:!0}))}const d=(f,p,v)=>{const b=Re(p.cause);f.getInfo().validationMetaMap[b]?.lastAbortController.abort();const x=new AbortController;this.getInfo().validationMetaMap[b]={lastAbortController:x},v.push(new Promise(async M=>{let y;try{y=await new Promise((F,w)=>{this.timeoutIds.validations[p.cause]&&clearTimeout(this.timeoutIds.validations[p.cause]),this.timeoutIds.validations[p.cause]=setTimeout(async()=>{if(x.signal.aborted)return F(void 0);try{F(await this.runValidator({validate:p.validate,value:{value:f.store.state.value,fieldApi:f,signal:x.signal,validationSource:"field"},type:"validateAsync"}))}catch(_){w(_)}},p.debounceMs)})}catch(F){y=F}if(x.signal.aborted)return M(void 0);const L=vt(y),E=r[this.name]?.[b],{newErrorValue:j,newSource:A}=ft({formLevelError:E,fieldLevelError:L});f.setMeta(F=>({...F,errorMap:{...F?.errorMap,[b]:j},errorSourceMap:{...F.errorSourceMap,[b]:A}})),M(j)}))};for(const f of n)f.validate&&d(this,f,u);for(const f of c)f.validate&&d(f.field,f,m);let h=[];if((u.length||m.length)&&(h=await Promise.all(u),await Promise.all(m)),l){this.setMeta(f=>({...f,isValidating:!1}));for(const f of a)f.setMeta(p=>({...p,isValidating:!1}))}return h.filter(Boolean)},this.validate=(s,i)=>{if(!this.state.meta.isTouched)return[];const{fieldsErrorMap:n}=i?.skipFormValidation?{fieldsErrorMap:{}}:this.form.validateSync(s),{hasErrored:r}=this.validateSync(s,n[this.name]??{});if(r&&!this.options.asyncAlways)return this.getInfo().validationMetaMap[Re(s)]?.lastAbortController.abort(),this.state.meta.errors;const a=i?.skipFormValidation?Promise.resolve({}):this.form.validateAsync(s);return this.validateAsync(s,a)},this.handleChange=s=>{this.setValue(s)},this.handleBlur=()=>{this.state.meta.isTouched||this.setMeta(i=>({...i,isTouched:!0})),this.state.meta.isBlurred||this.setMeta(i=>({...i,isBlurred:!0})),this.validate("blur"),this.triggerOnBlurListener()},this.setErrorMap=s=>{this.setMeta(i=>({...i,errorMap:{...i.errorMap,...s}}))},this.parseValueWithSchema=s=>Ee.validate({value:this.state.value,validationSource:"field"},s),this.parseValueWithSchemaAsync=s=>Ee.validateAsync({value:this.state.value,validationSource:"field"},s),this.triggerOnChangeListener=()=>{const s=this.form.options.listeners?.onChangeDebounceMs;s&&s>0?(this.timeoutIds.formListeners.change&&clearTimeout(this.timeoutIds.formListeners.change),this.timeoutIds.formListeners.change=setTimeout(()=>{this.form.options.listeners?.onChange?.({formApi:this.form,fieldApi:this})},s)):this.form.options.listeners?.onChange?.({formApi:this.form,fieldApi:this});const i=this.options.listeners?.onChangeDebounceMs;i&&i>0?(this.timeoutIds.listeners.change&&clearTimeout(this.timeoutIds.listeners.change),this.timeoutIds.listeners.change=setTimeout(()=>{this.options.listeners?.onChange?.({value:this.state.value,fieldApi:this})},i)):this.options.listeners?.onChange?.({value:this.state.value,fieldApi:this})},this.form=e.form,this.name=e.name,this.options=e,this.timeoutIds={validations:{},listeners:{},formListeners:{}},this.store=new me({deps:[this.form.store],fn:({prevVal:s})=>{const i=s,n=this.form.getFieldMeta(this.name)??{...Se,...e.defaultMeta};let r=this.form.getFieldValue(this.name);return!n.isTouched&&r===void 0&&this.options.defaultValue!==void 0&&!pe(r,this.options.defaultValue)&&(r=this.options.defaultValue),i&&i.value===r&&i.meta===n?i:{value:r,meta:n}}})}get state(){return this.store.state}runValidator(e){return Ct(e.validate)?Ee[e.type](e.value,e.validate):e.validate(e.value)}triggerOnBlurListener(){const e=this.form.options.listeners?.onBlurDebounceMs;e&&e>0?(this.timeoutIds.formListeners.blur&&clearTimeout(this.timeoutIds.formListeners.blur),this.timeoutIds.formListeners.blur=setTimeout(()=>{this.form.options.listeners?.onBlur?.({formApi:this.form,fieldApi:this})},e)):this.form.options.listeners?.onBlur?.({formApi:this.form,fieldApi:this});const s=this.options.listeners?.onBlurDebounceMs;s&&s>0?(this.timeoutIds.listeners.blur&&clearTimeout(this.timeoutIds.listeners.blur),this.timeoutIds.listeners.blur=setTimeout(()=>{this.options.listeners?.onBlur?.({value:this.state.value,fieldApi:this})},s)):this.options.listeners?.onBlur?.({value:this.state.value,fieldApi:this})}}function vt(t){if(t)return t}function Re(t){switch(t){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"dynamic":return"onDynamic";case"change":default:return"onChange"}}var Xe={exports:{}},Ye={},Ze={exports:{}},Je={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gt;function Es(){if(gt)return Je;gt=1;var t=wt();function e(d,h){return d===h&&(d!==0||1/d===1/h)||d!==d&&h!==h}var s=typeof Object.is=="function"?Object.is:e,i=t.useState,n=t.useEffect,r=t.useLayoutEffect,a=t.useDebugValue;function c(d,h){var f=h(),p=i({inst:{value:f,getSnapshot:h}}),v=p[0].inst,b=p[1];return r(function(){v.value=f,v.getSnapshot=h,u(v)&&b({inst:v})},[d,f,h]),n(function(){return u(v)&&b({inst:v}),d(function(){u(v)&&b({inst:v})})},[d]),a(f),f}function u(d){var h=d.getSnapshot;d=d.value;try{var f=h();return!s(d,f)}catch{return!0}}function m(d,h){return h()}var l=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?m:c;return Je.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:l,Je}var xt;function ws(){return xt||(xt=1,Ze.exports=Es()),Ze.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bt;function js(){if(bt)return Ye;bt=1;var t=wt(),e=ws();function s(m,l){return m===l&&(m!==0||1/m===1/l)||m!==m&&l!==l}var i=typeof Object.is=="function"?Object.is:s,n=e.useSyncExternalStore,r=t.useRef,a=t.useEffect,c=t.useMemo,u=t.useDebugValue;return Ye.useSyncExternalStoreWithSelector=function(m,l,d,h,f){var p=r(null);if(p.current===null){var v={hasValue:!1,value:null};p.current=v}else v=p.current;p=c(function(){function g(E){if(!x){if(x=!0,M=E,E=h(E),f!==void 0&&v.hasValue){var j=v.value;if(f(j,E))return y=j}return y=E}if(j=y,i(M,E))return j;var A=h(E);return f!==void 0&&f(j,A)?(M=E,j):(M=E,y=A)}var x=!1,M,y,L=d===void 0?null:d;return[function(){return g(l())},L===null?void 0:function(){return g(L())}]},[l,d,h,f]);var b=n(m,p[0],p[1]);return a(function(){v.hasValue=!0,v.value=b},[b]),u(b),b},Ye}var yt;function Vs(){return yt||(yt=1,Xe.exports=js()),Xe.exports}var ks=Vs();function he(t,e=i=>i,s={}){const i=s.equal??Fs;return ks.useSyncExternalStoreWithSelector(t.subscribe,()=>t.state,()=>t.state,e,i)}function Fs(t,e){if(Object.is(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;if(t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(const[i,n]of t)if(!e.has(i)||!Object.is(n,e.get(i)))return!1;return!0}if(t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0}if(t instanceof Date&&e instanceof Date)return t.getTime()===e.getTime();const s=St(t);if(s.length!==St(e).length)return!1;for(let i=0;i<s.length;i++)if(!Object.prototype.hasOwnProperty.call(e,s[i])||!Object.is(t[s[i]],e[s[i]]))return!1;return!0}function St(t){return Object.keys(t).concat(Object.getOwnPropertySymbols(t))}const Ge=typeof window<"u"?ne.useLayoutEffect:ne.useEffect;function Ls(t){const[e,s]=ne.useState(()=>({form:t.form,name:t.name})),[i,n]=ne.useState(()=>new pt({...t}));(e.form!==t.form||e.name!==t.name)&&(n(new pt({...t})),s({form:t.form,name:t.name}));const r=he(i.store,t.mode==="array"?f=>Object.keys(f.value??[]).length:f=>f.value),a=he(i.store,f=>f.meta.isTouched),c=he(i.store,f=>f.meta.isBlurred),u=he(i.store,f=>f.meta.isDirty),m=he(i.store,f=>f.meta.errorMap),l=he(i.store,f=>f.meta.errorSourceMap),d=he(i.store,f=>f.meta.isValidating),h=ne.useMemo(()=>{const p={...i,get state(){return{value:t.mode==="array"?i.state.value:r,get meta(){return{...i.state.meta,isTouched:a,isBlurred:c,isDirty:u,errorMap:m,errorSourceMap:l,isValidating:d}}}}};return p.Field=Dt,p},[i,t.mode,r,a,c,u,m,l,d]);return Ge(i.mount,[i]),Ge(()=>{i.update(t)}),h}const Dt=(({children:t,...e})=>{const s=Ls(e),i=ne.useMemo(()=>He(t,s),[t,s]);return o.jsx(o.Fragment,{children:i})});function As(){return ne.useState(()=>_t())[0]}const Ns=ne.version.split(".")[0]==="17"?As:ne.useId;function Ts({form:t,selector:e,children:s}){const i=he(t.store,e);return o.jsx(o.Fragment,{children:He(s,i)})}function Is(t){const e=Ns(),[s,i]=ne.useState(t?.formId),[n,r]=ne.useState(()=>new ht({...t,formId:t?.formId??e}));if(s!==t?.formId){const c=t?.formId??e;r(new ht({...t,formId:c})),i(c)}const a=ne.useMemo(()=>{const c={...n,handleSubmit:((...u)=>n._handleSubmit(...u)),get formId(){return n._formId},get state(){return n.store.state}};return c.Field=function(m){return o.jsx(Dt,{...m,form:n})},c.Subscribe=function(m){return o.jsx(Ts,{form:n,selector:m.selector,children:m.children})},c},[n]);return Ge(n.mount,[]),Ge(()=>{n.update(t)}),a}const _s={tool:Ut,run:Bt,debug:Wt,test:$t};function Fe(t){const e=oe.c(2),{icon:s}=t,i=_s[s];let n;return e[0]!==i?(n=o.jsx(i,{className:"icon-sm"}),e[0]=i,e[1]=n):n=e[1],n}function Pt(t){const e=oe.c(20),{workspaceRoot:s,workspaceGroup:i}=t;let n;e[0]!==i||e[1]!==s?(n=Nt(s,i),e[0]=i,e[1]=s,e[2]=n):n=e[2];const r=n,a=i?.rootFolder&&i.rootFolder!==r?`(${i.rootFolder})`:null,c=i?.isCodexWorktree?jt:Vt;let u;e[3]!==c?(u=o.jsx(c,{className:"icon-sm text-token-text-secondary shrink-0"}),e[3]=c,e[4]=u):u=e[4];let m;e[5]!==r?(m=o.jsx("span",{className:"truncate",children:r}),e[5]=r,e[6]=m):m=e[6];let l;e[7]!==a?(l=a&&o.jsx("span",{className:"text-token-description-foreground truncate text-xs",children:a}),e[7]=a,e[8]=l):l=e[8];let d;e[9]!==m||e[10]!==l?(d=o.jsxs("div",{className:"flex min-w-0 items-center gap-1 text-sm text-token-text-primary",children:[m,l]}),e[9]=m,e[10]=l,e[11]=d):d=e[11];let h;e[12]!==s?(h=o.jsx("span",{className:"text-token-text-secondary truncate text-xs",children:s}),e[12]=s,e[13]=h):h=e[13];let f;e[14]!==d||e[15]!==h?(f=o.jsxs("div",{className:"flex min-w-0 flex-col gap-1",children:[d,h]}),e[14]=d,e[15]=h,e[16]=f):f=e[16];let p;return e[17]!==u||e[18]!==f?(p=o.jsxs("div",{className:"flex items-center gap-3 p-3",children:[u,f]}),e[17]=u,e[18]=f,e[19]=p):p=e[19],p}const ot=`# e.g.
pip install -r requirements.txt
npm install
./run/setup.sh`,ze=["darwin","linux","win32"];function Cs(t){const e=oe.c(40),{workspaceRoot:s,workspaceGroup:i,configPath:n,configExists:r,initialEnvironment:a,parseErrorMessage:c,readErrorMessage:u,onExitEdit:m}=t,l=qe(),d=Gt(),h=zt();let f,p;if(e[0]!==a?.actions||e[1]!==a?.name||e[2]!==a?.setup||e[3]!==a?.version||e[4]!==l||e[5]!==s){const F=Et(s)??l.formatMessage({id:"settings.localEnvironments.environment.defaultName",defaultMessage:"local",description:"Fallback name for the local environment"}),w=a?.actions??[],_=a?.name??F,O=a?.setup?.script??"",k=Rs(a?.setup),T=qt(w,"");p=a?.version??1,f=Ps({name:_,setupScript:O,setupPlatformScripts:k,actions:T}),e[0]=a?.actions,e[1]=a?.name,e[2]=a?.setup,e[3]=a?.version,e[4]=l,e[5]=s,e[6]=f,e[7]=p}else f=e[6],p=e[7];const v=f;let b;e[8]!==n||e[9]!==l||e[10]!==m||e[11]!==d||e[12]!==h||e[13]!==s?(b={onSuccess:()=>{d.invalidateQueries({queryKey:dt("local-environment-config",{workspaceRoot:s})}),d.invalidateQueries({queryKey:dt("local-environment",{configPath:n})}),h.success(l.formatMessage({id:"settings.localEnvironments.save.success",defaultMessage:"Saved local environment",description:"Toast shown when local environment is saved"})),m()}},e[8]=n,e[9]=l,e[10]=m,e[11]=d,e[12]=h,e[13]=s,e[14]=b):b=e[14];const g=Ht("local-environment-config-save",b);let x;e[15]!==g||e[16]!==p||e[17]!==s?(x=F=>{const{value:w}=F,_=Mt(w,p);w.name.length===0||w.setupScript.length===0||g.mutate({workspaceRoot:s,raw:_})},e[15]=g,e[16]=p,e[17]=s,e[18]=x):x=e[18];let M;e[19]!==v||e[20]!==x?(M={defaultValues:v,onSubmit:x},e[19]=v,e[20]=x,e[21]=M):M=e[21];const y=Is(M);let L;e[22]!==y?(L=F=>{F.preventDefault(),y.handleSubmit()},e[22]=y,e[23]=L):L=e[23];let E;e[24]!==r||e[25]!==y||e[26]!==c||e[27]!==u||e[28]!==g.error||e[29]!==g.isPending||e[30]!==p||e[31]!==i||e[32]!==s?(E=F=>{const{values:w,isDirty:_}=F,O=w.name.length>0&&w.setupScript.length>0;Mt(w,p);const k=V=>{y.setFieldValue("setupPlatformVisibility",{...w.setupPlatformVisibility,[V]:!0})},T=V=>{y.setFieldValue("setupPlatformScripts",{...w.setupPlatformScripts,[V]:""}),y.setFieldValue("setupPlatformVisibility",{...w.setupPlatformVisibility,[V]:!1})},G=(V,R)=>{y.setFieldValue("setupPlatformScripts",{...w.setupPlatformScripts,[V]:R})},X=()=>{y.setFieldValue("actions",[...w.actions,Yt("")])},Y=V=>{y.setFieldValue("actions",w.actions.filter(R=>R.id!==V))},H=(V,R)=>{y.setFieldValue("actions",w.actions.map(z=>z.id!==V?z:{...z,...R}))},D=()=>{!O||!_||g.isPending||y.handleSubmit()};return o.jsxs(o.Fragment,{children:[o.jsxs(I,{children:[o.jsx(I.Header,{title:o.jsx(S,{id:"settings.localEnvironments.file.title",defaultMessage:"Local environment file",description:"Title for local environment file section"})}),o.jsxs(I.Content,{children:[o.jsx(se,{children:o.jsx(Pt,{workspaceRoot:s,workspaceGroup:i})}),r?null:o.jsx("div",{className:"text-token-text-secondary mt-1 text-sm",children:o.jsx(S,{id:"settings.localEnvironments.file.missing",defaultMessage:"Save to create this file for the first time.",description:"Message shown when local environment config does not exist"})}),c?o.jsx("div",{className:"text-token-error-foreground mt-2 text-sm",children:o.jsx(S,{id:"settings.localEnvironments.file.parseError",defaultMessage:"Unable to parse the existing file. Saving will overwrite it. ({error})",description:"Parse error message for local environment file",values:{error:c}})}):null,u?o.jsx("div",{className:"text-token-error-foreground mt-2 text-sm",children:o.jsx(S,{id:"settings.localEnvironments.file.readError",defaultMessage:"Failed to load local environment data. ({error})",description:"Read error message for local environment config",values:{error:u}})}):null]})]}),o.jsxs(I,{children:[o.jsx(I.Header,{title:o.jsx(S,{id:"settings.localEnvironments.environment.title",defaultMessage:"Environment details",description:"Title for local environment details section"})}),o.jsxs(I.Content,{className:"gap-[var(--padding-panel)]",children:[o.jsx(se,{children:o.jsx(kt,{label:o.jsx(S,{id:"settings.localEnvironments.environment.name",defaultMessage:"Name",description:"Label for environment name input"}),control:o.jsx("div",{className:"w-72",children:o.jsx(Ot,{id:"local-environment-name",value:w.name,onChange:V=>{y.setFieldValue("name",V)}})})})}),o.jsxs("div",{className:"flex flex-col gap-3",children:[o.jsxs("div",{className:"flex flex-col gap-1",children:[o.jsx("div",{className:"text-token-text-primary text-sm font-medium",children:o.jsx(S,{id:"settings.localEnvironments.environment.setup",defaultMessage:"Setup script",description:"Label for environment setup script input"})}),o.jsx("div",{className:"text-sm text-token-text-secondary",children:o.jsx(S,{id:"settings.localEnvironments.environment.setup.description",defaultMessage:"This script will run on worktree creation.",description:"Description for environment setup script summary"})})]}),o.jsx(se,{children:o.jsxs("div",{className:"flex flex-col gap-2 p-3",children:[o.jsx("div",{className:"text-token-text-secondary text-xs font-medium uppercase tracking-wide",children:o.jsx(S,{id:"settings.localEnvironments.environment.setup.script",defaultMessage:"Script",description:"Label for setup script input"})}),o.jsx("div",{className:"text-sm text-token-text-secondary",children:o.jsx(S,{id:"settings.localEnvironments.environment.setup.hint",defaultMessage:"Runs in the workspace root.",description:"Description for setup script input"})}),o.jsx(at,{id:"local-environment-setup-script",value:w.setupScript,placeholder:ot,rows:6,onChange:V=>{y.setFieldValue("setupScript",V)}})]})}),o.jsx(se,{children:o.jsxs("div",{className:"flex flex-col gap-3 p-3",children:[o.jsxs("div",{className:"flex flex-col gap-1",children:[o.jsx("div",{className:"text-token-text-secondary text-xs font-medium uppercase tracking-wide",children:o.jsx(S,{id:"settings.localEnvironments.environment.setup.platformOverrides",defaultMessage:"Platform overrides",description:"Label for setup script platform overrides"})}),o.jsx("div",{className:"text-sm text-token-text-secondary",children:o.jsx(S,{id:"settings.localEnvironments.environment.setup.platformOverrides.description",defaultMessage:"Overrides the default script for specific OSes.",description:"Description for setup script platform overrides"})})]}),o.jsx("div",{className:"flex flex-col gap-4",children:ze.map(V=>w.setupPlatformVisibility[V]?o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("div",{className:"text-token-text-secondary text-xs font-medium uppercase tracking-wide",children:Ae(V)}),o.jsx(ce,{color:"ghost",size:"toolbar",onClick:()=>{T(V)},children:o.jsx(S,{id:"settings.localEnvironments.environment.setup.platformOverrides.remove",defaultMessage:"Remove",description:"Button label to remove a setup script override"})})]}),o.jsx(at,{id:`local-environment-setup-platform-script-${V}`,value:w.setupPlatformScripts[V]??"",placeholder:ot,rows:6,onChange:R=>{G(V,R)}})]},V):null)}),o.jsx("div",{className:"flex flex-col items-start gap-2",children:ze.map(V=>w.setupPlatformVisibility[V]?null:o.jsx(ce,{color:"secondary",size:"toolbar",className:"w-auto",onClick:()=>{k(V)},children:o.jsx(S,{id:"settings.localEnvironments.environment.setup.platformOverrides.add",defaultMessage:"Add {platform} setup script",description:"Button label to add a platform-specific setup script",values:{platform:Ae(V)}})},V))})]})})]})]})]}),o.jsxs(I,{children:[o.jsx(I.Header,{title:o.jsx(S,{id:"settings.localEnvironments.actions.title",defaultMessage:"Actions",description:"Title for local environment actions section"}),actions:o.jsx(ce,{color:"secondary",size:"toolbar",onClick:X,children:o.jsx(S,{id:"settings.localEnvironments.actions.add",defaultMessage:"Add action",description:"Button label to add a local environment action"})})}),o.jsxs(I.Content,{className:"gap-1",children:[o.jsx("div",{className:"text-sm text-token-text-secondary",children:o.jsx(S,{id:"settings.localEnvironments.environment.actions.description",defaultMessage:"These actions can run any command and will be displayed in the header.",description:"Description for local environment actions summary"})}),w.actions.length===0?o.jsx(se,{children:o.jsx("div",{className:"p-3 text-sm text-token-text-secondary",children:o.jsx(S,{id:"settings.localEnvironments.actions.empty",defaultMessage:"Add an action to run commands from the local toolbar.",description:"Empty state for local environment actions"})})}):o.jsx("div",{className:"flex flex-col gap-3",children:w.actions.map(V=>o.jsx(Os,{action:V,onRemove:Y,onUpdate:H},V.id))})]})]}),o.jsxs(I,{children:[o.jsx(I.Header,{title:o.jsx(S,{id:"settings.localEnvironments.save.title",defaultMessage:"Save configuration",description:"Title for local environment save section"})}),o.jsxs(I.Content,{children:[null,o.jsx(se,{children:o.jsx("div",{className:"p-3 text-sm text-token-text-secondary",children:o.jsx(S,{id:"settings.localEnvironments.save.body",defaultMessage:"Save to apply your local environment settings.",description:"Body text for local environment save section"})})}),g.error?o.jsx("div",{className:"text-token-error-foreground text-sm",children:o.jsx(S,{id:"settings.localEnvironments.preview.saveError",defaultMessage:"Failed to save the file. ({error})",description:"Error message when saving local environment file fails",values:{error:g.error.message}})}):null]})]}),o.jsx("div",{className:"flex justify-end",children:o.jsx(ce,{color:"primary",size:"toolbar",disabled:!O||!_||g.isPending,onClick:D,children:o.jsx(S,{id:"settings.localEnvironments.preview.save",defaultMessage:"Save",description:"Save button label for local environment file"})})})]})},e[24]=r,e[25]=y,e[26]=c,e[27]=u,e[28]=g.error,e[29]=g.isPending,e[30]=p,e[31]=i,e[32]=s,e[33]=E):E=e[33];let j;e[34]!==y.Subscribe||e[35]!==E?(j=o.jsx(y.Subscribe,{selector:Ds,children:E}),e[34]=y.Subscribe,e[35]=E,e[36]=j):j=e[36];let A;return e[37]!==L||e[38]!==j?(A=o.jsx("form",{className:"flex flex-col gap-[var(--padding-panel)]",onSubmit:L,children:j}),e[37]=L,e[38]=j,e[39]=A):A=e[39],A}function Ds(t){return{values:t.values,isDirty:t.isDirty}}function Ps({name:t,setupScript:e,setupPlatformScripts:s,actions:i}){return{name:t,setupScript:e,setupPlatformScripts:s,setupPlatformVisibility:Ws(s),actions:i}}function Mt(t,e){return Kt({version:e,name:t.name,setupScript:t.setupScript,setupPlatformScripts:$s(t.setupPlatformScripts),actions:t.actions})}function Ot(t){const e=oe.c(6),{id:s,value:i,onChange:n}=t;let r;e[0]!==n?(r=c=>{n(c.target.value)},e[0]=n,e[1]=r):r=e[1];let a;return e[2]!==s||e[3]!==r||e[4]!==i?(a=o.jsx("input",{id:s,className:"bg-token-input-background text-token-text-primary w-full rounded-md border border-token-border px-2.5 py-1.5 text-sm outline-none focus-visible:ring-2 focus-visible:ring-token-focus",value:i,onChange:r}),e[2]=s,e[3]=r,e[4]=i,e[5]=a):a=e[5],a}function at(t){const e=oe.c(8),{id:s,value:i,rows:n,placeholder:r,onChange:a}=t;let c;e[0]!==a?(c=m=>{a(m.target.value)},e[0]=a,e[1]=c):c=e[1];let u;return e[2]!==s||e[3]!==r||e[4]!==n||e[5]!==c||e[6]!==i?(u=o.jsx("textarea",{id:s,className:"bg-token-input-background text-token-text-primary font-mono w-full rounded-md border border-token-border px-2.5 py-2 text-sm outline-none focus-visible:ring-2 focus-visible:ring-token-focus",value:i,rows:n,placeholder:r,onChange:c}),e[2]=s,e[3]=r,e[4]=n,e[5]=c,e[6]=i,e[7]=u):u=e[7],u}function Os(t){const e=oe.c(108),{action:s,onRemove:i,onUpdate:n}=t,r=qe(),{data:a}=Qt();let c,u,m,l,d,h,f,p,v,b,g,x,M;if(e[0]!==s.icon||e[1]!==s.id||e[2]!==s.platform||e[3]!==r||e[4]!==n||e[5]!==a?.platform){const P=Us(r),xe=s.icon??"tool",fe=P.find(de=>de.value===xe)??P[0],be=fe.ariaLabel;l=s.platform!=null;let N;e[19]!==s.platform||e[20]!==a?.platform?(N=s.platform??Gs(a?.platform),e[19]=s.platform,e[20]=a?.platform,e[21]=N):N=e[21],d=N;let C;e[22]!==s.id||e[23]!==n||e[24]!==d?(C=de=>{if(de){n(s.id,{platform:d});return}n(s.id,{platform:null})},e[22]=s.id,e[23]=n,e[24]=d,e[25]=C):C=e[25],u=C;let q;e[26]!==s.id||e[27]!==l||e[28]!==n?(q=de=>{l&&n(s.id,{platform:de})},e[26]=s.id,e[27]=l,e[28]=n,e[29]=q):q=e[29],m=q,M="bg-token-input-background border-token-border flex flex-col gap-3 rounded-lg border p-3",g="flex flex-col gap-2";const re=`local-env-action-name-${s.id}`;let Ne;e[30]===Symbol.for("react.memo_cache_sentinel")?(Ne=o.jsx(S,{id:"settings.localEnvironments.actions.item.name",defaultMessage:"Name",description:"Label for local environment action name"}),e[30]=Ne):Ne=e[30],e[31]!==re?(x=o.jsx("label",{className:"text-token-text-secondary text-xs font-medium uppercase tracking-wide",htmlFor:re,children:Ne}),e[31]=re,e[32]=x):x=e[32],b="flex items-center gap-2",c=Zt,h="start",f="min-w-[120px] px-1",p=o.jsx(ce,{id:`local-env-action-icon-${s.id}`,className:"w-12 justify-center text-sm",color:"secondary",size:"toolbar","aria-label":be,children:fe.icon});let Te;e[33]!==s.id||e[34]!==n?(Te=de=>o.jsx(Jt.Item,{tooltipText:de.ariaLabel,onSelect:()=>{n(s.id,{icon:de.value})},children:de.icon},de.value),e[33]=s.id,e[34]=n,e[35]=Te):Te=e[35],v=P.map(Te),e[0]=s.icon,e[1]=s.id,e[2]=s.platform,e[3]=r,e[4]=n,e[5]=a?.platform,e[6]=c,e[7]=u,e[8]=m,e[9]=l,e[10]=d,e[11]=h,e[12]=f,e[13]=p,e[14]=v,e[15]=b,e[16]=g,e[17]=x,e[18]=M}else c=e[6],u=e[7],m=e[8],l=e[9],d=e[10],h=e[11],f=e[12],p=e[13],v=e[14],b=e[15],g=e[16],x=e[17],M=e[18];let y;e[36]!==c||e[37]!==h||e[38]!==f||e[39]!==p||e[40]!==v?(y=o.jsx(c,{align:h,contentClassName:f,triggerButton:p,children:v}),e[36]=c,e[37]=h,e[38]=f,e[39]=p,e[40]=v,e[41]=y):y=e[41];const L=`local-env-action-name-${s.id}`;let E;e[42]!==s.id||e[43]!==n?(E=P=>{n(s.id,{name:P})},e[42]=s.id,e[43]=n,e[44]=E):E=e[44];let j;e[45]!==s.name||e[46]!==L||e[47]!==E?(j=o.jsx("div",{className:"flex-1",children:o.jsx(Ot,{id:L,value:s.name,onChange:E})}),e[45]=s.name,e[46]=L,e[47]=E,e[48]=j):j=e[48];let A;e[49]!==j||e[50]!==b||e[51]!==y?(A=o.jsxs("div",{className:b,children:[y,j]}),e[49]=j,e[50]=b,e[51]=y,e[52]=A):A=e[52];let F;e[53]!==A||e[54]!==g||e[55]!==x?(F=o.jsxs("div",{className:g,children:[x,A]}),e[53]=A,e[54]=g,e[55]=x,e[56]=F):F=e[56];const w=`local-env-action-command-${s.id}`;let _;e[57]===Symbol.for("react.memo_cache_sentinel")?(_=o.jsx(S,{id:"settings.localEnvironments.actions.item.command",defaultMessage:"Action script",description:"Label for local environment action script"}),e[57]=_):_=e[57];let O;e[58]!==w?(O=o.jsx("label",{className:"text-token-text-secondary text-xs font-medium uppercase tracking-wide",htmlFor:w,children:_}),e[58]=w,e[59]=O):O=e[59];const k=`local-env-action-command-${s.id}`;let T;e[60]!==s.id||e[61]!==n?(T=P=>{n(s.id,{command:P})},e[60]=s.id,e[61]=n,e[62]=T):T=e[62];let G;e[63]!==s.command||e[64]!==k||e[65]!==T?(G=o.jsx(at,{id:k,value:s.command,placeholder:ot,rows:4,onChange:T}),e[63]=s.command,e[64]=k,e[65]=T,e[66]=G):G=e[66];let X;e[67]!==O||e[68]!==G?(X=o.jsxs("div",{className:"flex flex-col gap-2",children:[O,G]}),e[67]=O,e[68]=G,e[69]=X):X=e[69];let Y;e[70]===Symbol.for("react.memo_cache_sentinel")?(Y=o.jsx("div",{className:"text-token-text-secondary text-xs font-medium uppercase tracking-wide",children:o.jsx(S,{id:"settings.localEnvironments.actions.item.platforms",defaultMessage:"Platforms",description:"Label for local environment action platforms"})}),e[70]=Y):Y=e[70];let H;e[71]===Symbol.for("react.memo_cache_sentinel")?(H=o.jsx("div",{className:"text-token-text-secondary text-xs",children:o.jsx(S,{id:"settings.localEnvironments.actions.item.platforms.help",defaultMessage:"Only run on a specific OS.",description:"Help text for action platforms selection"})}),e[71]=H):H=e[71];const D=`local-env-action-platform-specific-${s.id}`;let V;e[72]!==u||e[73]!==l||e[74]!==D?(V=o.jsx(es,{id:D,checked:l,onCheckedChange:u}),e[72]=u,e[73]=l,e[74]=D,e[75]=V):V=e[75];const R=`local-env-action-platform-specific-${s.id}`;let z;e[76]===Symbol.for("react.memo_cache_sentinel")?(z=o.jsx(S,{id:"settings.localEnvironments.actions.item.platforms.specific",defaultMessage:"Platform specific",description:"Label for enabling platform-specific action selection"}),e[76]=z):z=e[76];let $;e[77]!==R?($=o.jsx("label",{className:"text-token-text-secondary",htmlFor:R,children:z}),e[77]=R,e[78]=$):$=e[78];let ee;e[79]!==V||e[80]!==$?(ee=o.jsx("div",{className:"min-w-0",children:o.jsxs("div",{className:"flex flex-col gap-2",children:[Y,H,o.jsxs("div",{className:"relative flex items-center gap-2 text-sm",children:[V,$]})]})}),e[79]=V,e[80]=$,e[81]=ee):ee=e[81];let W;e[82]!==m||e[83]!==r||e[84]!==l||e[85]!==d?(W=l?o.jsx("div",{className:"flex justify-start",children:o.jsx(Xt,{selectedId:d,onSelect:m,ariaLabel:r.formatMessage({id:"settings.localEnvironments.actions.item.platforms.selector",defaultMessage:"Platform selection",description:"Aria label for platform selection toggle"}),options:Bs(r)})}):null,e[82]=m,e[83]=r,e[84]=l,e[85]=d,e[86]=W):W=e[86];let K;e[87]!==ee||e[88]!==W?(K=o.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:gap-6",children:[ee,W]}),e[87]=ee,e[88]=W,e[89]=K):K=e[89];let Z;e[90]===Symbol.for("react.memo_cache_sentinel")?(Z=o.jsx(S,{id:"settings.localEnvironments.actions.item.tooltip.delete",defaultMessage:"Delete",description:"Tooltip for removing a local environment action"}),e[90]=Z):Z=e[90];let ae;e[91]!==r?(ae=r.formatMessage({id:"settings.localEnvironments.actions.item.button.delete",defaultMessage:"Delete",description:"Label for removing a local environment action"}),e[91]=r,e[92]=ae):ae=e[92];let te;e[93]!==s.id||e[94]!==i?(te=()=>{i(s.id)},e[93]=s.id,e[94]=i,e[95]=te):te=e[95];let Q;e[96]===Symbol.for("react.memo_cache_sentinel")?(Q=o.jsx(ts,{className:"icon-sm"}),e[96]=Q):Q=e[96];let B;e[97]!==ae||e[98]!==te?(B=o.jsx("div",{className:"flex justify-end sm:justify-center",children:o.jsx(Ft,{tooltipContent:Z,children:o.jsx(ce,{"aria-label":ae,color:"ghost",size:"toolbar",onClick:te,children:Q})})}),e[97]=ae,e[98]=te,e[99]=B):B=e[99];let U;e[100]!==K||e[101]!==B?(U=o.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[K,B]}),e[100]=K,e[101]=B,e[102]=U):U=e[102];let J;return e[103]!==F||e[104]!==X||e[105]!==U||e[106]!==M?(J=o.jsxs("div",{className:M,children:[F,X,U]}),e[103]=F,e[104]=X,e[105]=U,e[106]=M,e[107]=J):J=e[107],J}function Rs(t){const e={darwin:"",linux:"",win32:""};return t&&(t.darwin?.script&&(e.darwin=t.darwin.script),t.linux?.script&&(e.linux=t.linux.script),t.win32?.script&&(e.win32=t.win32.script)),e}function $s(t){const e={};for(const s of ze){const i=t[s];i&&i.length>0&&(e[s]=i)}return e}function Ws(t){const e={darwin:!1,linux:!1,win32:!1};for(const s of ze){const i=t[s];i&&i.length>0&&(e[s]=!0)}return e}function Ae(t){return t==="darwin"?o.jsx(S,{id:"settings.localEnvironments.actions.item.platforms.macos",defaultMessage:"macOS",description:"Label for macOS platform toggle"}):t==="linux"?o.jsx(S,{id:"settings.localEnvironments.actions.item.platforms.linux",defaultMessage:"Linux",description:"Label for Linux platform toggle"}):o.jsx(S,{id:"settings.localEnvironments.actions.item.platforms.windows",defaultMessage:"Windows",description:"Label for Windows platform toggle"})}function Bs(t){return[{id:"darwin",label:Ae("darwin"),ariaLabel:t.formatMessage({id:"settings.localEnvironments.actions.item.platforms.macos",defaultMessage:"macOS",description:"Label for macOS platform toggle"})},{id:"linux",label:Ae("linux"),ariaLabel:t.formatMessage({id:"settings.localEnvironments.actions.item.platforms.linux",defaultMessage:"Linux",description:"Label for Linux platform toggle"})},{id:"win32",label:Ae("win32"),ariaLabel:t.formatMessage({id:"settings.localEnvironments.actions.item.platforms.windows",defaultMessage:"Windows",description:"Label for Windows platform toggle"})}]}function Us(t){return[{ariaLabel:t.formatMessage({id:"settings.localEnvironments.actions.icon.tool",defaultMessage:"Tool",description:"Tool icon label for local environment actions"}),value:"tool",icon:o.jsx(Fe,{icon:"tool"})},{ariaLabel:t.formatMessage({id:"settings.localEnvironments.actions.icon.run",defaultMessage:"Run",description:"Run icon label for local environment actions"}),value:"run",icon:o.jsx(Fe,{icon:"run"})},{ariaLabel:t.formatMessage({id:"settings.localEnvironments.actions.icon.debug",defaultMessage:"Debug",description:"Debug icon label for local environment actions"}),value:"debug",icon:o.jsx(Fe,{icon:"debug"})},{ariaLabel:t.formatMessage({id:"settings.localEnvironments.actions.icon.test",defaultMessage:"Test",description:"Test icon label for local environment actions"}),value:"test",icon:o.jsx(Fe,{icon:"test"})}]}function Gs(t){return t==="darwin"||t==="linux"||t==="win32"?t:"darwin"}function zs(t){const e=oe.c(33),{workspaceRoot:s,workspaceGroup:i,configExists:n,initialEnvironment:r,parseErrorMessage:a,readErrorMessage:c,onEdit:u}=t,m=n&&r!=null;let l;e[0]!==r?.actions?(l=r?.actions??[],e[0]=r?.actions,e[1]=l):l=e[1];const d=l,h=r?.setup.script??"",f=r?.setup.darwin?.script??"",p=r?.setup.linux?.script??"",v=r?.setup.win32?.script??"",b=f.length>0||p.length>0||v.length>0;let g;e[2]===Symbol.for("react.memo_cache_sentinel")?(g=o.jsx(I.Header,{title:o.jsx(S,{id:"settings.localEnvironments.workspace.title",defaultMessage:"Workspace",description:"Title for the workspace summary section"})}),e[2]=g):g=e[2];let x;e[3]!==i||e[4]!==s?(x=o.jsxs(I,{children:[g,o.jsx(I.Content,{children:o.jsx(se,{children:o.jsx(Pt,{workspaceRoot:s,workspaceGroup:i})})})]}),e[3]=i,e[4]=s,e[5]=x):x=e[5];let M;e[6]===Symbol.for("react.memo_cache_sentinel")?(M=o.jsx(I.Header,{title:o.jsx(S,{id:"settings.localEnvironments.environment.title",defaultMessage:"Environment details",description:"Title for local environment details section"})}),e[6]=M):M=e[6];let y;e[7]!==d||e[8]!==m||e[9]!==b||e[10]!==r||e[11]!==f||e[12]!==p||e[13]!==h||e[14]!==v?(y=m&&r?o.jsxs(o.Fragment,{children:[o.jsx(se,{children:o.jsx(kt,{label:o.jsx(S,{id:"settings.localEnvironments.environment.name",defaultMessage:"Name",description:"Label for environment name input"}),control:o.jsx("span",{className:"text-token-text-secondary text-sm",children:r.name})})}),o.jsxs("div",{className:"flex flex-col gap-3",children:[o.jsxs("div",{className:"flex flex-col gap-1",children:[o.jsx("div",{className:"text-token-text-primary text-sm font-medium",children:o.jsx(S,{id:"settings.localEnvironments.environment.setup",defaultMessage:"Setup script",description:"Label for environment setup script input"})}),o.jsx("div",{className:"text-sm text-token-text-secondary",children:o.jsx(S,{id:"settings.localEnvironments.environment.setup.description",defaultMessage:"This script will run on worktree creation.",description:"Description for environment setup script summary"})})]}),o.jsx(Lt,{language:"bash",content:h,shouldWrapCode:!0,codeContainerClassName:"max-h-40"}),b?o.jsxs("div",{className:"flex flex-col gap-3",children:[o.jsxs("div",{className:"flex flex-col gap-1",children:[o.jsx("div",{className:"text-token-text-secondary text-xs font-medium uppercase tracking-wide",children:o.jsx(S,{id:"settings.localEnvironments.environment.setup.platformOverrides",defaultMessage:"Platform overrides",description:"Label for setup script platform overrides"})}),o.jsx("div",{className:"text-sm text-token-text-secondary",children:o.jsx(S,{id:"settings.localEnvironments.environment.setup.platformOverrides.description",defaultMessage:"Overrides the default script for specific OSes.",description:"Description for setup script platform overrides"})})]}),f.length>0?o.jsx(et,{platform:"darwin",script:f}):null,p.length>0?o.jsx(et,{platform:"linux",script:p}):null,v.length>0?o.jsx(et,{platform:"win32",script:v}):null]}):null]}),o.jsxs("div",{className:"flex flex-col gap-3",children:[o.jsxs("div",{className:"flex flex-col gap-1",children:[o.jsx("div",{className:"text-token-text-primary text-sm font-medium",children:o.jsx(S,{id:"settings.localEnvironments.environment.actionsLabel",defaultMessage:"Actions",description:"Label for actions count in local environment summary"})}),o.jsx("div",{className:"text-sm text-token-text-secondary",children:o.jsx(S,{id:"settings.localEnvironments.environment.actions.description",defaultMessage:"These actions can run any command and will be displayed in the header.",description:"Description for local environment actions summary"})})]}),o.jsx(se,{children:o.jsx("div",{className:"flex flex-col gap-2 p-3",children:d.length>0?o.jsx("div",{className:"flex flex-col gap-2",children:d.map(qs)}):o.jsx("div",{className:"text-sm text-token-text-secondary",children:o.jsx(S,{id:"settings.localEnvironments.actions.empty",defaultMessage:"Add an action to run commands from the local toolbar.",description:"Empty state for local environment actions"})})})})]})]}):o.jsx(se,{children:o.jsx("div",{className:"p-3 text-sm text-token-text-secondary",children:o.jsx(S,{id:"settings.localEnvironments.environment.empty",defaultMessage:"No local environment is configured for this workspace yet.",description:"Empty state when no local environment is configured"})})}),e[7]=d,e[8]=m,e[9]=b,e[10]=r,e[11]=f,e[12]=p,e[13]=h,e[14]=v,e[15]=y):y=e[15];let L;e[16]!==a?(L=a?o.jsx("div",{className:"text-token-error-foreground mt-2 text-sm",children:o.jsx(S,{id:"settings.localEnvironments.file.parseError",defaultMessage:"Unable to parse the existing file. Saving will overwrite it. ({error})",description:"Parse error message for local environment file",values:{error:a}})}):null,e[16]=a,e[17]=L):L=e[17];let E;e[18]!==c?(E=c?o.jsx("div",{className:"text-token-error-foreground mt-2 text-sm",children:o.jsx(S,{id:"settings.localEnvironments.file.readError",defaultMessage:"Failed to load local environment data. ({error})",description:"Read error message for local environment config",values:{error:c}})}):null,e[18]=c,e[19]=E):E=e[19];let j;e[20]!==y||e[21]!==L||e[22]!==E?(j=o.jsxs(I,{children:[M,o.jsxs(I.Content,{className:"gap-[var(--padding-panel)]",children:[y,L,E]})]}),e[20]=y,e[21]=L,e[22]=E,e[23]=j):j=e[23];let A;e[24]!==m?(A=m?o.jsx(S,{id:"settings.localEnvironments.environment.edit",defaultMessage:"Edit local environment",description:"Button label to edit a local environment"}):o.jsx(S,{id:"settings.localEnvironments.environment.create",defaultMessage:"Create local environment",description:"Button label to create a local environment"}),e[24]=m,e[25]=A):A=e[25];let F;e[26]!==u||e[27]!==A?(F=o.jsx("div",{className:"flex justify-end",children:o.jsx(ce,{color:"primary",size:"toolbar",onClick:u,children:A})}),e[26]=u,e[27]=A,e[28]=F):F=e[28];let w;return e[29]!==F||e[30]!==x||e[31]!==j?(w=o.jsxs("div",{className:"flex flex-col gap-[var(--padding-panel)]",children:[x,j,F]}),e[29]=F,e[30]=x,e[31]=j,e[32]=w):w=e[32],w}function qs(t,e){return o.jsxs("div",{className:"text-token-text-secondary flex items-center gap-2 text-sm",children:[o.jsx("span",{className:"text-token-text-secondary",children:o.jsx(Fe,{icon:t.icon??"tool"})}),o.jsx("span",{children:t.name})]},`${t.name}-${e}`)}function Hs(t){return t==="darwin"?o.jsx(S,{id:"settings.localEnvironments.actions.item.platforms.macos",defaultMessage:"macOS",description:"Label for macOS platform toggle"}):t==="linux"?o.jsx(S,{id:"settings.localEnvironments.actions.item.platforms.linux",defaultMessage:"Linux",description:"Label for Linux platform toggle"}):o.jsx(S,{id:"settings.localEnvironments.actions.item.platforms.windows",defaultMessage:"Windows",description:"Label for Windows platform toggle"})}function et(t){const e=oe.c(9),{platform:s,script:i}=t;let n;e[0]!==s?(n=Hs(s),e[0]=s,e[1]=n):n=e[1];let r;e[2]!==n?(r=o.jsx("div",{className:"text-token-text-secondary text-xs font-medium uppercase tracking-wide",children:n}),e[2]=n,e[3]=r):r=e[3];let a;e[4]!==i?(a=o.jsx(Lt,{language:"bash",content:i,shouldWrapCode:!0,codeContainerClassName:"max-h-40"}),e[4]=i,e[5]=a):a=e[5];let c;return e[6]!==r||e[7]!==a?(c=o.jsxs("div",{className:"flex flex-col gap-2",children:[r,a]}),e[6]=r,e[7]=a,e[8]=c):c=e[8],c}function Ks(t){const e=oe.c(13),{groups:s,isLoading:i,onAddWorkspace:n,onSelectWorkspace:r}=t;let a;e[0]===Symbol.for("react.memo_cache_sentinel")?(a=o.jsx(S,{id:"settings.localEnvironments.workspaceSelect.title",defaultMessage:"Select a workspace",description:"Title for the workspace selection step"}),e[0]=a):a=e[0];let c;e[1]===Symbol.for("react.memo_cache_sentinel")?(c=o.jsx(S,{id:"settings.localEnvironments.workspace.add",defaultMessage:"Add workspace",description:"Button label to add a new workspace"}),e[1]=c):c=e[1];let u;e[2]!==n?(u=o.jsx(I.Header,{title:a,actions:o.jsx(ce,{color:"secondary",size:"toolbar",onClick:n,children:c})}),e[2]=n,e[3]=u):u=e[3];let m;e[4]===Symbol.for("react.memo_cache_sentinel")?(m=o.jsx("div",{className:"text-sm text-token-text-secondary",children:o.jsx(S,{id:"settings.localEnvironments.workspaceSelect.description",defaultMessage:"Local environments are configured per workspace.",description:"Description for the workspace selection step"})}),e[4]=m):m=e[4];let l;e[5]!==s||e[6]!==i||e[7]!==n||e[8]!==r?(l=o.jsx(I.Content,{children:o.jsxs("div",{className:"flex flex-col gap-2",children:[m,o.jsx(Qs,{groups:s,isLoading:i,onAddWorkspace:n,onSelectWorkspace:r})]})}),e[5]=s,e[6]=i,e[7]=n,e[8]=r,e[9]=l):l=e[9];let d;return e[10]!==u||e[11]!==l?(d=o.jsxs(I,{children:[u,l]}),e[10]=u,e[11]=l,e[12]=d):d=e[12],d}function Qs(t){const e=oe.c(15),{groups:s,isLoading:i,onAddWorkspace:n,onSelectWorkspace:r}=t,a=qe();if(i){let l;return e[0]===Symbol.for("react.memo_cache_sentinel")?(l=o.jsx(se,{children:o.jsxs("div",{className:"flex items-center gap-2 p-3 text-sm text-token-text-secondary",children:[o.jsx(At,{className:"icon-xs"}),o.jsx(S,{id:"settings.localEnvironments.workspaceSelect.loading",defaultMessage:"Loading workspaces.",description:"Loading message while workspace options are fetched"})]})}),e[0]=l):l=e[0],l}if(s.length===0){let l;e[1]===Symbol.for("react.memo_cache_sentinel")?(l=o.jsx(S,{id:"settings.localEnvironments.workspaceSelect.empty",defaultMessage:"No workspaces yet. Add one to configure local environments.",description:"Empty state when no workspace roots are available"}),e[1]=l):l=e[1];let d;e[2]===Symbol.for("react.memo_cache_sentinel")?(d=o.jsx(S,{id:"settings.localEnvironments.workspace.add",defaultMessage:"Add workspace",description:"Button label to add a new workspace"}),e[2]=d):d=e[2];let h;return e[3]!==n?(h=o.jsx(se,{children:o.jsxs("div",{className:"flex flex-col gap-3 p-3 text-sm text-token-text-secondary",children:[l,o.jsx("div",{children:o.jsx(ce,{color:"primary",size:"toolbar",onClick:n,children:d})})]})}),e[3]=n,e[4]=h):h=e[4],h}let c;e[5]!==a?(c=a.formatMessage({id:"settings.localEnvironments.workspaceSelect.listLabel",defaultMessage:"Available workspaces",description:"Aria label for the workspace selection list"}),e[5]=a,e[6]=c):c=e[6];let u;if(e[7]!==s||e[8]!==r){let l;e[10]!==r?(l=d=>o.jsx(Xs,{group:d,onSelectWorkspace:r},d.path),e[10]=r,e[11]=l):l=e[11],u=s.map(l),e[7]=s,e[8]=r,e[9]=u}else u=e[9];let m;return e[12]!==c||e[13]!==u?(m=o.jsx("div",{className:"flex flex-col gap-3",role:"list","aria-label":c,children:u}),e[12]=c,e[13]=u,e[14]=m):m=e[14],m}function Xs(t){const e=oe.c(69),{group:s,onSelectWorkspace:i}=t,n=qe();let r;e[0]!==s.path?(r={params:{workspaceRoot:s.path}},e[0]=s.path,e[1]=r):r=e[1];const{data:a,isLoading:c,error:u}=ve("local-environment-config",r),m=a?.configPath??"";let l;e[2]!==m?(l={configPath:m},e[2]=m,e[3]=l):l=e[3];const d=!!a?.exists;let h;e[4]!==d?(h={enabled:d},e[4]=d,e[5]=h):h=e[5];let f;e[6]!==l||e[7]!==h?(f={params:l,queryConfig:h},e[6]=l,e[7]=h,e[8]=f):f=e[8];const{data:p,isLoading:v,error:b}=ve("local-environment",f),x=s.isCodexWorktree?jt:Vt,M=s.ownerRepo?.owner??null,y=p?.environment.type==="success"?p.environment.environment.name:null,L=!!a?.exists&&y!=null,E=u!=null||b!=null||p?.environment.type==="error",j=c||v,A=!j&&!E&&!L;let F;e[9]!==y||e[10]!==L||e[11]!==E||e[12]!==n||e[13]!==j?(F=j?n.formatMessage({id:"settings.localEnvironments.workspaceSelect.loadingLabel",defaultMessage:"Loading environment",description:"Label for environment row while loading"}):E?n.formatMessage({id:"settings.localEnvironments.workspaceSelect.errorLabel",defaultMessage:"Environment needs attention",description:"Label for environment row when environment data fails"}):L?y:n.formatMessage({id:"settings.localEnvironments.workspaceSelect.emptyLabel",defaultMessage:"No environment yet",description:"Label for workspace without a local environment"}),e[9]=y,e[10]=L,e[11]=E,e[12]=n,e[13]=j,e[14]=F):F=e[14];const w=F;let _;e[15]!==L||e[16]!==n?(_=L?n.formatMessage({id:"settings.localEnvironments.workspaceSelect.viewAction",defaultMessage:"View",description:"Action label to view a local environment"}):n.formatMessage({id:"settings.localEnvironments.workspaceSelect.createAction",defaultMessage:"Create",description:"Action label to create a local environment"}),e[15]=L,e[16]=n,e[17]=_):_=e[17];const O=_,k=L||E;let T;e[18]!==n?(T=n.formatMessage({id:"settings.localEnvironments.workspaceSelect.addDisabled",defaultMessage:"Multiple environments coming soon.",description:"Tooltip message for disabled add environment button"}),e[18]=n,e[19]=T):T=e[19];const G=T;let X;e[20]!==n?(X=n.formatMessage({id:"settings.localEnvironments.workspaceSelect.addLabel",defaultMessage:"Add environment",description:"Aria label for add environment button"}),e[20]=n,e[21]=X):X=e[21];const Y=X;let H;e[22]!==s.path||e[23]!==i?(H=()=>{i(s.path)},e[22]=s.path,e[23]=i,e[24]=H):H=e[24];let D;e[25]!==x?(D=o.jsx(x,{className:"icon-sm text-token-text-secondary shrink-0"}),e[25]=x,e[26]=D):D=e[26];let V;e[27]!==s.label?(V=o.jsx("span",{className:"truncate font-medium",children:s.label}),e[27]=s.label,e[28]=V):V=e[28];let R;e[29]!==M?(R=M?o.jsx("span",{className:"text-token-text-secondary truncate",children:M}):null,e[29]=M,e[30]=R):R=e[30];let z;e[31]!==V||e[32]!==R?(z=o.jsxs("div",{className:"flex min-w-0 items-center gap-2 text-sm text-token-text-primary",children:[V,R]}),e[31]=V,e[32]=R,e[33]=z):z=e[33];let $;e[34]!==H||e[35]!==D||e[36]!==z?($=o.jsxs("button",{className:"flex min-w-0 items-center gap-3 text-left",type:"button",onClick:H,children:[D,z]}),e[34]=H,e[35]=D,e[36]=z,e[37]=$):$=e[37];let ee;e[38]===Symbol.for("react.memo_cache_sentinel")?(ee=o.jsx(ss,{className:"icon-sm"}),e[38]=ee):ee=e[38];let W;e[39]!==Y?(W=o.jsx("span",{className:"inline-flex",children:o.jsx(ce,{className:"w-9 justify-center","aria-label":Y,color:"secondary",disabled:!0,size:"toolbar",children:ee})}),e[39]=Y,e[40]=W):W=e[40];let K;e[41]!==G||e[42]!==W?(K=o.jsx(Ft,{tooltipContent:G,children:W}),e[41]=G,e[42]=W,e[43]=K):K=e[43];let Z;e[44]!==$||e[45]!==K?(Z=o.jsxs("div",{className:"flex items-center justify-between gap-2 px-4 py-3",children:[$,K]}),e[44]=$,e[45]=K,e[46]=Z):Z=e[46];const ae=A?"flex-1 text-center text-sm text-token-text-secondary":"flex items-center gap-2 text-sm text-token-text-primary";let te;e[47]!==j?(te=j?o.jsx(At,{className:"icon-xs"}):null,e[47]=j,e[48]=te):te=e[48];let Q;e[49]!==w||e[50]!==s.path||e[51]!==i||e[52]!==A?(Q=A?o.jsx("span",{children:w}):o.jsx("button",{className:"text-left",type:"button",onClick:()=>{i(s.path)},children:w}),e[49]=w,e[50]=s.path,e[51]=i,e[52]=A,e[53]=Q):Q=e[53];let B;e[54]!==ae||e[55]!==te||e[56]!==Q?(B=o.jsxs("div",{className:ae,children:[te,Q]}),e[54]=ae,e[55]=te,e[56]=Q,e[57]=B):B=e[57];let U;e[58]!==O||e[59]!==s.path||e[60]!==i||e[61]!==k?(U=k?o.jsx(ce,{color:"ghost",size:"toolbar",onClick:()=>{i(s.path)},children:O}):null,e[58]=O,e[59]=s.path,e[60]=i,e[61]=k,e[62]=U):U=e[62];let J;e[63]!==B||e[64]!==U?(J=o.jsx("div",{className:"border-t border-token-border px-4 py-3",children:o.jsxs("div",{className:"flex items-center justify-between gap-3",children:[B,U]})}),e[63]=B,e[64]=U,e[65]=J):J=e[65];let P;return e[66]!==Z||e[67]!==J?(P=o.jsxs(se,{className:"p-0",children:[Z,J]}),e[66]=Z,e[67]=J,e[68]=P):P=e[68],P}function ei(){const t=oe.c(71),{data:e,isLoading:s}=ve("workspace-root-options"),i=e?.roots??[],n=e?.labels??{};let r;t[0]===Symbol.for("react.memo_cache_sentinel")?(r={select:Zs},t[0]=r):r=t[0];const{data:a}=ve("codex-home",r),{data:c,isPlaceholderData:u,isLoading:m}=ve("git-origins",{params:{dirs:i},queryConfig:{enabled:i.length>0}}),l=!c&&(u||m),d=is(ns(null,void 0,i,n,c?.origins,a,l),i),[h,f]=ne.useState(null),[p,v]=ne.useState(!1),g=h??null,x=g!=null&&i.includes(g)?g:null,M=x!=null?d.find(N=>N.path===x)??null:null,y=x==null,L=Ys;let E;t[1]!==v||t[2]!==f?(E=N=>{f(N),v(!1)},t[1]=v,t[2]=f,t[3]=E):E=t[3];const j=E;let A;t[4]!==v||t[5]!==f?(A=()=>{f(null),v(!1)},t[4]=v,t[5]=f,t[6]=A):A=t[6];const F=A;let w;t[7]!==v?(w=()=>{v(!0)},t[7]=v,t[8]=w):w=t[8];const _=w;let O;t[9]!==v?(O=()=>{v(!1)},t[9]=v,t[10]=O):O=t[10];const k=O,T=x??"";let G;t[11]!==T?(G={workspaceRoot:T},t[11]=T,t[12]=G):G=t[12];const X=!y&&x!=null;let Y;t[13]!==X?(Y={enabled:X},t[13]=X,t[14]=Y):Y=t[14];let H;t[15]!==G||t[16]!==Y?(H={params:G,queryConfig:Y},t[15]=G,t[16]=Y,t[17]=H):H=t[17];const{data:D,isLoading:V,error:R}=ve("local-environment-config",H),z=D?.configPath??"";let $;t[18]!==z?($={configPath:z},t[18]=z,t[19]=$):$=t[19];const ee=!y&&x!=null&&!!D?.exists;let W;t[20]!==ee?(W={enabled:ee},t[20]=ee,t[21]=W):W=t[21];let K;t[22]!==$||t[23]!==W?(K={params:$,queryConfig:W},t[22]=$,t[23]=W,t[24]=K):K=t[24];const{data:Z,error:ae,isLoading:te}=ve("local-environment",K),Q=Z?.environment.type==="success"?Z.environment.environment:null,B=Z?.environment.type==="error"?Z.environment.error.message:null,U=R?.message??ae?.message??null;let J;t[25]!==F||t[26]!==k||t[27]!==p||t[28]!==x||t[29]!==M?(J=x!=null?o.jsx(os,{workspaceRoot:x,workspaceGroup:M,mode:p?"edit":void 0,onBack:p?k:F}):null,t[25]=F,t[26]=k,t[27]=p,t[28]=x,t[29]=M,t[30]=J):J=t[30];const P=J;if(y){let N;t[31]===Symbol.for("react.memo_cache_sentinel")?(N=o.jsx(we,{slug:"local-environments",messagePrefix:"settings.section"}),t[31]=N):N=t[31];let C;return t[32]!==j||t[33]!==d||t[34]!==s?(C=o.jsx(je,{title:N,children:o.jsx(Ks,{groups:d,isLoading:s,onAddWorkspace:L,onSelectWorkspace:j})}),t[32]=j,t[33]=d,t[34]=s,t[35]=C):C=t[35],C}if(V||te){let N;t[36]===Symbol.for("react.memo_cache_sentinel")?(N=o.jsx(we,{slug:"local-environments",messagePrefix:"settings.section"}),t[36]=N):N=t[36];let C;t[37]===Symbol.for("react.memo_cache_sentinel")?(C=o.jsx(I.Header,{title:o.jsx(S,{id:"settings.localEnvironments.loading.title",defaultMessage:"Loading local environments",description:"Loading state title for local environments settings"})}),t[37]=C):C=t[37];let q;t[38]===Symbol.for("react.memo_cache_sentinel")?(q=o.jsxs(I,{children:[C,o.jsx(I.Content,{children:o.jsx(se,{children:o.jsx("div",{className:"p-3 text-sm text-token-text-secondary",children:o.jsx(S,{id:"settings.localEnvironments.loading.body",defaultMessage:"Fetching your workspace configuration.",description:"Loading state body for local environments settings"})})})})]}),t[38]=q):q=t[38];let re;return t[39]!==P?(re=o.jsx(je,{title:N,backSlot:P,children:q}),t[39]=P,t[40]=re):re=t[40],re}if(!D||x==null){let N;t[41]===Symbol.for("react.memo_cache_sentinel")?(N=o.jsx(we,{slug:"local-environments",messagePrefix:"settings.section"}),t[41]=N):N=t[41];let C;t[42]===Symbol.for("react.memo_cache_sentinel")?(C=o.jsx(I.Header,{title:o.jsx(S,{id:"settings.localEnvironments.unavailable.title",defaultMessage:"Local environments unavailable",description:"Title for missing local environment config state"})}),t[42]=C):C=t[42];let q;t[43]===Symbol.for("react.memo_cache_sentinel")?(q=o.jsxs(I,{children:[C,o.jsx(I.Content,{children:o.jsx(se,{children:o.jsx("div",{className:"p-3 text-sm text-token-text-secondary",children:o.jsx(S,{id:"settings.localEnvironments.unavailable.body",defaultMessage:"We could not load local environment settings for this workspace.",description:"Body text for missing local environment config state"})})})})]}),t[43]=q):q=t[43];let re;return t[44]!==P?(re=o.jsx(je,{title:N,backSlot:P,children:q}),t[44]=P,t[45]=re):re=t[45],re}if(p){let N;t[46]===Symbol.for("react.memo_cache_sentinel")?(N=o.jsx(we,{slug:"local-environments",messagePrefix:"settings.section"}),t[46]=N):N=t[46];let C;t[47]!==D.configPath||t[48]!==D.exists||t[49]!==k||t[50]!==Q||t[51]!==B||t[52]!==U||t[53]!==x||t[54]!==M?(C=o.jsx(Cs,{workspaceRoot:x,workspaceGroup:M,configPath:D.configPath,configExists:D.exists,initialEnvironment:Q,parseErrorMessage:B,readErrorMessage:U,onExitEdit:k}),t[47]=D.configPath,t[48]=D.exists,t[49]=k,t[50]=Q,t[51]=B,t[52]=U,t[53]=x,t[54]=M,t[55]=C):C=t[55];let q;return t[56]!==P||t[57]!==C?(q=o.jsx(je,{title:N,backSlot:P,children:C}),t[56]=P,t[57]=C,t[58]=q):q=t[58],q}let xe;t[59]===Symbol.for("react.memo_cache_sentinel")?(xe=o.jsx(we,{slug:"local-environments",messagePrefix:"settings.section"}),t[59]=xe):xe=t[59];let fe;t[60]!==D.exists||t[61]!==_||t[62]!==Q||t[63]!==B||t[64]!==U||t[65]!==x||t[66]!==M?(fe=o.jsx(zs,{workspaceRoot:x,workspaceGroup:M,configExists:D.exists,initialEnvironment:Q,parseErrorMessage:B,readErrorMessage:U,onEdit:_}),t[60]=D.exists,t[61]=_,t[62]=Q,t[63]=B,t[64]=U,t[65]=x,t[66]=M,t[67]=fe):fe=t[67];let be;return t[68]!==P||t[69]!==fe?(be=o.jsx(je,{title:xe,backSlot:P,children:fe}),t[68]=P,t[69]=fe,t[70]=be):be=t[70],be}function Ys(){rs.dispatchMessage("electron-add-new-workspace-root-option",{})}function Zs(t){return t?.codexHome}export{ei as LocalEnvironmentsSettings};
