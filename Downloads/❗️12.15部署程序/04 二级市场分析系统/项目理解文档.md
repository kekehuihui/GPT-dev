# 二级市场分析系统 - 项目理解文档

## 📋 项目概述

这是一个**股票二级市场实时分析系统**，代号 "Alpha-Core | 掠食者雷达 V13.2"。它是一个单页面Web应用，集成了实时股票数据、AI分析和可视化功能。

---

## 🏗️ 系统架构

### 1. **前端技术栈**
- **HTML5 + CSS3 + JavaScript**：纯前端实现，无需后端服务器
- **Tailwind CSS**：用于快速构建现代化UI界面
- **Canvas API**：用于绘制K线图表
- **Gemini AI API**：集成Google的AI能力进行智能分析

### 2. **核心功能模块**

#### 📊 左侧面板：盘口数据
- **五档盘口显示**：显示买卖五档价格和成交量
- **主力身份识别**：AI分析盘口数据，识别主力资金特征
- **实时价格显示**：当前价、涨跌幅、成交量
- **数据源切换器**：支持切换不同数据源（公网/Wind/东财）

#### 📈 中间面板：图表与AI工具
- **K线图表**：实时绘制价格走势
- **Alpha置信度评分**：0-100分的投资信心指数
- **AI功能工具栏**：
  - 📸 **视觉分析**：AI分析K线形态
  - 🎨 **情绪图腾**：生成市场情绪可视化图像
  - ⚖️ **多空庭辩**：模拟多空双方辩论
  - 🔮 **首席风控官**：风险评估报告
  - ⚔️ **沙盘推演**：压力测试和情景分析
  - 📜 **历史回溯**：寻找历史相似走势

#### 📉 右侧面板：因子分析
- **资金合力 (M-Factor)**：分析散户/游资/机构资金流向
- **基本面 (F-Factor)**：ROE、造假风险等基本面指标
- **情绪因子 (T-Factor)**：全网舆情挖掘和分析

#### 💬 底部面板：系统日志与工具箱
- **运行日志**：显示系统运行状态和数据更新记录
- **心理按摩**：AI心理辅导功能
- **智能策略**：生成投资建议（支持语音播报）
- **全网舆情挖掘**：抓取网络上的股票讨论和传闻

---

## 🔧 技术实现细节

### 数据获取方式

#### 1. **公网数据源（默认）**
```javascript
// 使用腾讯财经接口获取实时行情
fetchRealStockData()  // 获取实时价格和盘口
fetchIntradayData()   // 获取分时数据
```

#### 2. **专业数据源（预留接口）**
```javascript
// Wind万得数据（需要API Key）
fetchWindData(code)

// 东方财富L2数据（需要Token）
fetchEastMoneyData(code)
```

### AI功能实现

系统使用 **Google Gemini AI** 实现以下功能：

1. **文本生成**：策略建议、风控报告、心理辅导
2. **视觉分析**：分析K线图表截图
3. **图像生成**：使用Imagen 4生成情绪图腾
4. **语音合成**：将策略文本转换为语音
5. **网络搜索**：挖掘全网舆情信息

### 数据流转过程

```
用户输入股票代码 
  ↓
选择数据源（公网/Wind/东财）
  ↓
获取实时行情数据
  ↓
清洗为标准格式（state对象）
  ↓
更新UI（价格、盘口、图表）
  ↓
AI分析（可选）
  ↓
显示分析结果
```

---

## 🎨 UI设计特点

### 视觉风格
- **深色主题**：黑色背景（#09090b），减少视觉疲劳
- **科技感**：紫色主题色（#8b5cf6），扫描线动画效果
- **信息密度高**：紧凑布局，信息量大

### 交互设计
- **实时更新**：每3秒自动刷新数据
- **模态弹窗**：AI分析结果以弹窗形式展示
- **悬浮工具栏**：左侧悬浮的AI功能按钮
- **聊天窗口**："幽灵"AI助手，可进行对话

---

## 🔑 关键代码结构

### 状态管理
```javascript
const state = {
    code: 'sh600519',        // 股票代码
    name: '贵州茅台',         // 股票名称
    price: 1750.00,          // 当前价格
    prevClose: 1740.00,      // 昨收价
    asks: [],                // 卖盘五档
    bids: [],                // 买盘五档
    mode: 'soros',           // 策略模式（索罗斯/巴菲特）
    source: 'public'         // 数据源
}
```

### 核心函数

1. **changeStock()**：切换股票，重新获取数据
2. **updateUI()**：更新所有UI元素
3. **drawChart()**：绘制K线图表
4. **callGemini()**：调用AI API的统一接口

---

## 🚀 使用流程

1. **初始化**：页面加载后自动连接默认股票（sh600519）
2. **切换股票**：在顶部输入框输入股票代码（如：sz000001）
3. **查看数据**：左侧查看盘口，中间查看K线
4. **使用AI功能**：点击左侧工具栏按钮进行分析
5. **查看分析结果**：在弹窗中查看AI生成的分析报告

---

## ⚙️ 配置说明

### API Key配置
```javascript
const apiKey = '';  // 第313行，需要填入Google Gemini API Key
```

### 数据源配置
```javascript
// 第340-351行，配置专业数据源
const adapters = {
    wind: {
        enabled: false,
        apiKey: 'YOUR_WIND_API_KEY',
        endpoint: 'https://api.wind.com.cn/v1/market/realtime'
    },
    eastmoney: {
        enabled: false,
        token: 'YOUR_EM_TOKEN',
        endpoint: 'https://push2.eastmoney.com/api/qt/stock/get'
    }
}
```

---

## 💡 项目亮点

1. **单文件架构**：所有代码在一个HTML文件中，易于部署
2. **模块化设计**：功能清晰分离，易于维护
3. **AI深度集成**：多个AI功能模块，提供全方位分析
4. **数据源可扩展**：预留了专业数据源接口
5. **实时性强**：3秒刷新，实时更新市场数据

---

## 🎓 学习要点

### 对于初学者
1. **HTML结构**：学习如何组织复杂的单页应用
2. **CSS样式**：Tailwind CSS的使用方法
3. **JavaScript异步**：Promise、async/await的使用
4. **Canvas绘图**：如何绘制图表
5. **API调用**：如何调用外部API获取数据

### 进阶理解
1. **适配器模式**：数据源切换的实现方式
2. **状态管理**：如何管理应用状态
3. **事件驱动**：用户交互如何触发数据更新
4. **AI集成**：如何将AI能力集成到应用中

---

## ⚠️ 注意事项

1. **API Key**：需要配置Google Gemini API Key才能使用AI功能
2. **网络限制**：公网数据源可能受跨域限制，需要代理或后端支持
3. **数据准确性**：公网数据仅供参考，专业投资需使用专业数据源
4. **浏览器兼容**：建议使用Chrome等现代浏览器

---

## 🔮 扩展方向

1. **后端支持**：添加后端API，解决跨域问题
2. **数据存储**：保存历史数据和用户配置
3. **多股票监控**：同时监控多只股票
4. **策略回测**：历史数据回测功能
5. **移动端适配**：响应式设计，支持手机访问
