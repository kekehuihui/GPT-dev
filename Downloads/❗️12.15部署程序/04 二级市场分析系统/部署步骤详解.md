# 🚀 部署步骤详解（手把手教程）

## 第一步：提交代码到Git

### 方法1：使用脚本（推荐）

```bash
cd "/Users/dongxuanke/Downloads/❗️12.15部署程序/04 二级市场分析系统"

# 给脚本执行权限
chmod +x 部署执行脚本.sh

# 执行脚本
./部署执行脚本.sh
```

### 方法2：手动执行

```bash
cd "/Users/dongxuanke/Downloads/❗️12.15部署程序/04 二级市场分析系统"

# 添加所有文件
git add .

# 提交
git commit -m "Complete: 前后端分离版本 - 所有功能已实现"

# 推送到GitHub（如果有远程仓库）
git push origin main
```

---

## 第二步：部署后端到Vercel

### 2.1 访问Vercel

1. 打开浏览器，访问：**https://vercel.com**
2. 点击右上角 **"Sign Up"** 或 **"Log In"**
3. 选择 **"Continue with GitHub"** 使用GitHub账号登录

### 2.2 导入项目

1. 登录后，点击 **"Add New..."** → **"Project"**
2. 在 **"Import Git Repository"** 中，选择你的GitHub仓库
   - 如果没有看到仓库，点击 **"Adjust GitHub App Permissions"** 授权
3. 选择仓库后，点击 **"Import"**

### 2.3 配置项目（⚠️ 重要！）

在配置页面：

1. **Framework Preset**
   - 选择：**"Other"**

2. **Root Directory** ⚠️ **必须设置！**
   - 点击 **"Edit"**
   - 输入：`backend`
   - 点击 **"Continue"**

3. **Build Command**
   - 留空（不需要构建）

4. **Output Directory**
   - 留空（不需要输出目录）

5. 点击 **"Deploy"**

### 2.4 配置环境变量

1. 部署开始后，点击项目名称进入项目页面
2. 点击顶部菜单 **"Settings"**
3. 左侧菜单选择 **"Environment Variables"**
4. 点击 **"Add New"**
5. 填写：
   - **Name**: `GEMINI_API_KEY`
   - **Value**: 你的Gemini API Key
   - **Environment**: 选择 **"Production, Preview, Development"**（全选）
6. 点击 **"Save"**
7. 回到 **"Deployments"** 标签
8. 点击最新部署右侧的 **"..."** → **"Redeploy"**

### 2.5 获取部署URL

1. 等待部署完成（通常30秒-1分钟）
2. 部署成功后，你会看到：
   - **Production**: `https://your-project-name.vercel.app`
3. **复制这个URL**，下一步需要用到！

---

## 第三步：更新前端API地址

### 方法1：修改代码（推荐用于测试）

1. 编辑文件：`frontend/js/api.js`
2. 找到第5行：
   ```javascript
   const API_BASE_URL = window.API_BASE_URL || 'https://your-vercel-app.vercel.app';
   ```
3. 替换为你的Vercel地址：
   ```javascript
   const API_BASE_URL = window.API_BASE_URL || 'https://你的实际vercel地址.vercel.app';
   ```
4. 保存文件
5. 提交更改：
   ```bash
   git add frontend/js/api.js
   git commit -m "Update API base URL"
   git push origin main
   ```

### 方法2：使用环境变量（推荐用于生产）

在Cloudflare Pages中配置（见下一步）

---

## 第四步：部署前端到Cloudflare Pages

### 4.1 访问Cloudflare

1. 打开浏览器，访问：**https://dash.cloudflare.com**
2. 登录你的Cloudflare账号

### 4.2 创建Pages项目

1. 左侧菜单点击 **"Workers & Pages"**
2. 点击 **"Create Application"**
3. 选择 **"Pages"** 标签
4. 点击 **"Connect to Git"**

### 4.3 连接GitHub

1. 选择 **"GitHub"**
2. 授权Cloudflare访问你的GitHub账号
3. 选择你的仓库：`stock-analysis-system`
4. 点击 **"Begin setup"**

### 4.4 配置构建设置（⚠️ 重要！）

在配置页面：

1. **Project name**
   - 输入：`stock-analysis-frontend`

2. **Production branch**
   - 选择：`main`

3. **Build command**
   - 留空（不需要构建）

4. **Build output directory** ⚠️ **必须设置！**
   - 输入：`frontend`
   - 这告诉Cloudflare从哪个目录部署

5. 点击 **"Environment variables"** 展开

6. 添加环境变量：
   - 点击 **"Add variable"**
   - **Variable name**: `API_BASE_URL`
   - **Value**: 你的Vercel部署URL（第二步获取的）
   - 点击 **"Add"**

7. 点击 **"Save and Deploy"**

### 4.5 等待部署完成

1. 部署通常需要1-2分钟
2. 部署完成后，你会看到：
   - **Production URL**: `https://stock-analysis-frontend.pages.dev`
3. **复制这个URL**，这就是你的前端访问地址！

---

## 第五步：测试验证

### 5.1 访问前端

1. 打开浏览器，访问Cloudflare Pages提供的URL
2. 你应该看到系统界面

### 5.2 测试功能

1. **测试股票数据**
   - 在顶部输入框输入：`sh600519`
   - 点击 **"连接数据"**
   - 检查是否显示股票信息

2. **测试AI功能**
   - 点击左侧工具栏的 **"视觉分析"**
   - 等待AI分析结果
   - 检查是否正常显示

3. **测试聊天功能**
   - 点击底部 **"呼叫 幽灵"**
   - 输入问题，测试聊天

### 5.3 检查控制台

1. 按 **F12** 打开开发者工具
2. 切换到 **"Console"** 标签
3. 检查是否有错误（红色）
4. 切换到 **"Network"** 标签
5. 执行操作，检查API请求
6. 确认请求发送到Vercel地址

---

## 🎉 部署完成！

如果所有测试通过，恭喜你！系统已成功部署！

### 你现在拥有：

- ✅ **前端**: Cloudflare Pages（全球CDN加速）
- ✅ **后端**: Vercel（Serverless自动扩展）
- ✅ **安全**: API Key隐藏在后端
- ✅ **性能**: 自动扩展和CDN加速

### 访问地址：

- **前端**: Cloudflare Pages URL
- **后端API**: Vercel URL（用于调试）

---

## 🆘 遇到问题？

### 问题1：前端无法连接后端

**检查：**
- API地址是否正确
- 浏览器控制台错误信息

**解决：**
- 确认 `API_BASE_URL` 环境变量配置正确
- 检查Vercel是否部署成功

### 问题2：API返回错误

**检查：**
- Vercel环境变量是否配置
- API Key是否有效

**解决：**
- 在Vercel中检查 `GEMINI_API_KEY`
- 查看Vercel函数日志

### 问题3：404错误

**检查：**
- Root Directory和Build output directory是否正确

**解决：**
- Vercel: Root Directory = `backend`
- Cloudflare: Build output directory = `frontend`

---

**现在开始执行吧！** 🚀
