# 🚀 部署检查清单

## ✅ 代码准备（已完成）

- [x] 后端API文件已创建
- [x] 前端HTML/CSS/JS已分离
- [x] API客户端已创建
- [x] 配置文件已创建
- [x] 所有Gemini调用已改为 `gemini-3-pro-preview`

## 📋 部署前检查

### 1. 代码完整性检查

```bash
# 检查项目结构
ls -la frontend/
ls -la backend/api/

# 应该看到：
# frontend/
#   ├── index.html
#   ├── assets/style.css
#   └── js/
#       ├── api.js
#       └── app.js
# 
# backend/
#   ├── api/
#   │   ├── gemini/ (5个文件)
#   │   ├── stock/ (2个文件)
#   │   └── imagen.js
#   ├── package.json
#   └── vercel.json
```

### 2. 配置API地址

**重要：** 在部署前端之前，需要配置后端API地址

**方法1：** 修改 `frontend/js/api.js`
```javascript
const API_BASE_URL = 'https://your-vercel-app.vercel.app';
```

**方法2：** 在Cloudflare Pages环境变量中设置
- 变量名：`API_BASE_URL`
- 变量值：你的Vercel部署地址

## 🎯 部署步骤

### 步骤1：创建GitHub仓库

1. 在GitHub创建新仓库（如：`stock-analysis-system`）
2. 初始化并推送代码：

```bash
cd "/Users/dongxuanke/Downloads/❗️12.15部署程序/04 二级市场分析系统"
git init
git add .
git commit -m "Initial commit: 前后端分离版本"
git branch -M main
git remote add origin https://github.com/your-username/stock-analysis-system.git
git push -u origin main
```

### 步骤2：部署后端到Vercel

1. 访问 [Vercel Dashboard](https://vercel.com/dashboard)
2. 点击 "Add New..." > "Project"
3. 导入你的GitHub仓库
4. 配置项目：
   - **Framework Preset**: Other
   - **Root Directory**: `backend`
   - **Build Command**: (留空)
   - **Output Directory**: (留空)
5. **添加环境变量**：
   - 名称：`GEMINI_API_KEY`
   - 值：你的Gemini API Key
6. 点击 "Deploy"
7. **复制部署地址**（如：`https://stock-analysis-backend.vercel.app`）

### 步骤3：更新前端API地址

**选项A：** 修改代码（临时方案）
```bash
# 编辑 frontend/js/api.js
# 将 API_BASE_URL 改为你的Vercel地址
```

**选项B：** 使用环境变量（推荐）
- 在Cloudflare Pages中配置环境变量

### 步骤4：部署前端到Cloudflare Pages

1. 访问 [Cloudflare Dashboard](https://dash.cloudflare.com)
2. 进入 "Workers & Pages"
3. 点击 "Create Application" > "Pages" > "Connect to Git"
4. 选择你的GitHub仓库
5. 配置构建设置：
   - **Project name**: `stock-analysis-frontend`
   - **Production branch**: `main`
   - **Build command**: (留空)
   - **Build output directory**: `frontend`
6. **添加环境变量**：
   - 名称：`API_BASE_URL`
   - 值：你的Vercel部署地址（步骤2中复制的地址）
7. 点击 "Save and Deploy"

### 步骤5：测试

1. 访问Cloudflare Pages提供的URL
2. 打开浏览器开发者工具（F12）
3. 检查控制台是否有错误
4. 测试功能：
   - [ ] 输入股票代码，点击"连接数据"
   - [ ] 测试AI功能（视觉分析、情绪图腾等）
   - [ ] 测试聊天功能
   - [ ] 检查数据是否正常显示

## 🔧 故障排查

### 问题1：API调用失败（CORS错误）

**解决：**
- 检查Vercel的 `vercel.json` 中CORS配置
- 确保允许的域名包含Cloudflare Pages域名

### 问题2：API返回401/403错误

**解决：**
- 检查Vercel环境变量 `GEMINI_API_KEY` 是否配置
- 确认API Key有效

### 问题3：前端无法加载资源

**解决：**
- 检查Cloudflare Pages的构建输出目录是否为 `frontend`
- 确认文件路径正确（相对路径）

### 问题4：Gemini API调用失败

**解决：**
- 检查模型名称是否为 `gemini-3-pro-preview`
- 查看Vercel函数日志
- 确认API Key有足够配额

## 📝 部署后验证清单

- [ ] 前端页面正常加载
- [ ] 股票数据可以获取
- [ ] AI功能正常工作
- [ ] 聊天功能正常
- [ ] 没有控制台错误
- [ ] 网络请求正常（Network标签）

## 🎉 完成！

部署成功后，你将拥有：
- ✅ 安全的后端API（API Key隐藏）
- ✅ 快速的前端静态站点（CDN加速）
- ✅ 可扩展的架构
- ✅ 生产环境部署

## 📞 需要帮助？

如果遇到问题：
1. 查看 `README.md` - 完整部署指南
2. 查看 `backend/README.md` - API文档
3. 检查浏览器控制台和Vercel日志
